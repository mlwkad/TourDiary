"use strict";const e=require("../common/vendor.js"),s=require("./http.js");let t="";t="https://ovmmqfovxbil.sealosbja.site";const o=(s,t)=>new Promise(((o,r)=>{e.index.uploadFile({url:t,filePath:s,name:"file",success:e=>{if(200===e.statusCode){const s=JSON.parse(e.data);o(s.success?s.data:null)}else r(`服务器错误(${e.statusCode})`)},fail:e=>r(e)})}));exports.addLiked=(e,t)=>s.http(`/api/user/${e}/liked`,{releaseID:t},"POST"),exports.checkLogin=e=>s.http("/api/checkLogin",e,"POST"),exports.createRelease=e=>s.http("/api/release",e,"POST"),exports.deleteRelease=(e,t)=>s.http(`/api/release/${e}`,{userID:t},"DELETE"),exports.follow=(e,t)=>s.http(`/api/user/${e}/follow`,t,"POST"),exports.getAllReleases=(e=50,t=0)=>s.http("/api/releases",{limit:e,offset:t}),exports.getFollowingList=e=>s.http(`/api/user/${e}/following`),exports.getReleaseDetail=e=>s.http(`/api/release/${e}`),exports.getUserInfo=e=>s.http(`/api/user/${e}`),exports.getUserLiked=e=>s.http(`/api/user/${e}/liked`),exports.getUserReleases=e=>s.http(`/api/user/${e}/releases`),exports.removeLiked=(e,t)=>s.http(`/api/user/${e}/liked/${t}`,{},"DELETE"),exports.searchReleases=e=>s.http("/api/releases/search",e,"POST"),exports.signUp=e=>s.http("/api/signUp",e,"POST"),exports.unfollow=(e,t)=>s.http(`/api/user/${e}/follow/${t}`,{},"DELETE"),exports.updateRelease=(e,t)=>s.http(`/api/release/${e}`,t,"PUT"),exports.updateState=(e,t)=>s.http(`/api/release/${e}/state`,t,"PUT"),exports.updateUserInfo=(e,t)=>s.http(`/api/user/${e}`,t,"PUT"),exports.uploadFiles=async(s,t="")=>{const r=Array.isArray(s)?s:[s];if(0===r.length||!r[0])return{pictures:[],videos:[],covers:[]};let p="https://ovmmqfovxbil.sealosbja.site/api/upload";t&&(p+=`?type=${t}`);try{e.index.showLoading({title:"上传中..."});const s={pictures:[],videos:[],covers:[]};for(const e of r){const t=await o(e,p);t&&(t.pictures&&s.pictures.push(t.pictures),t.videos&&s.videos.push(t.videos),t.covers&&s.covers.push(t.covers))}return s}catch(i){return console.log(i),{pictures:[],videos:[],covers:[]}}finally{e.index.hideLoading()}};
