"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a=require("../../api/api.js"),i=require("../../api/ws.js"),l=e.defineComponent({__name:"detail",setup(l,{expose:o}){const s=e.ref(!1),n=e.ref(!1),u=e.ref(!1),c=e.ref(""),r=e.ref(""),d=e.ref([]),v=e.ref({avatar:"",content:"",createdAt:"0000-00-00",id:0,location:"",money:"",personNum:0,pictures:["/static/555.jpg"],playTime:0,releaseID:"release0",title:"",updatedAt:"0000-00-00",userID:"",userName:"testuser0",videos:[]}),p=e.ref([{id:1,title:"附近景点",image:"/static/public/build.png",selectedImage:"/static/public/build-white.png"},{id:2,title:"附近美食",image:"/static/public/food.png",selectedImage:"/static/public/food-white.png"},{id:3,title:"经济旅游",image:"/static/public/sale.png",selectedImage:"/static/public/sale-white.png"},{id:4,title:"自驾旅游",image:"/static/public/jeepCar.png",selectedImage:"/static/public/jeepCar-white.png"},{id:5,title:"特色住宿",image:"/static/public/hotal.png",selectedImage:"/static/public/hotal-white.png"},{id:6,title:"购物攻略",image:"/static/public/shopping.png",selectedImage:"/static/public/shopping-white.png"}]),g=()=>{const e=p.value.filter((e=>d.value.includes(e.id)));let t="";e.forEach((e=>{t+=e.title+","}));const a=`我想去${c.value}游玩,并为我提供${t}的建议,分点明确(一级标题:一,二 二级标题:1,2),不要出现*#等特殊符号`;i.streamChat(a,(e=>{"update"===e.type?r.value+=e.content:"error"===e.type&&console.log(e.error)}))},f=()=>{e.index.setClipboardData({data:r.value,success:()=>{e.index.showToast({title:"复制成功",icon:"none"})}})},m=()=>{r.value=""},h=async()=>{try{const t=JSON.parse(e.index.getStorageSync("userInfo")).userId;s.value?(await a.removeLiked(t,v.value.releaseID),e.index.showToast({title:"取消收藏",icon:"none"})):(await a.addLiked(t,v.value.releaseID),e.index.showToast({title:"收藏成功",icon:"none"}));const i=await a.getUserInfo(t);s.value=JSON.parse(i.liked).includes(v.value.releaseID)}catch(t){console.log(t),e.index.showToast({title:"操作失败",icon:"none"})}},I=()=>{e.index.navigateTo({url:`/pages/follow/works?userID=${v.value.userID}`})};o({onShareAppMessage:()=>({title:"旅游日记分享",path:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(v.value))}`,imageUrl:v.value.pictures[0]||"/static/public/555.jpg"}),onShareTimeline:()=>({title:"旅游日记分享",query:`info=${encodeURIComponent(JSON.stringify(v.value))}`,imageUrl:v.value.pictures[0]||"/static/public/555.jpg"})});const w=()=>{const t=JSON.parse(e.index.getStorageSync("userInfo")).userId;n.value?e.index.showModal({title:"取关提示",content:`确定要取消关注"${v.value.userName}"吗？`,success:async i=>{if(i.confirm)try{await a.unfollow(t,v.value.userID),e.index.showToast({title:"已取消关注",icon:"none"});const i=await a.getUserInfo(t);n.value=i.follow.includes(v.value.userID)}catch(l){console.log(l),e.index.showToast({title:"操作失败",icon:"none"})}}}):e.index.showModal({title:"关注提示",content:`确定要关注"${v.value.userName}"吗？`,success:async i=>{if(i.confirm)try{await a.follow(t,{followUserID:v.value.userID}),e.index.showToast({title:"关注成功",icon:"none"});const i=await a.getUserInfo(t);n.value=i.follow.includes(v.value.userID)}catch(l){console.log(l),e.index.showToast({title:l,icon:"none"})}}})},_=(t,a)=>{const i=t.map((e=>String(e)));e.index.previewImage({urls:i,current:i[a],fail:e=>{console.error("预览失败:",e)}})},b=t=>{const a=t.detail.fullScreen||t.detail.fullscreen,i=t.detail.direction;a?e.index.showToast({title:`已进入${"vertical"===i?"竖向":"横向"}全屏模式`,icon:"none",duration:1500}):e.index.showToast({title:"已退出全屏模式",icon:"none",duration:1500})},x=t=>{console.error("视频播放错误:",t.detail),e.index.showToast({title:"视频播放失败",icon:"none"})};return e.onLoad((async t=>{try{if(t.info){const e=JSON.parse(decodeURIComponent(t.info));v.value=e}if(c.value=v.value.location,v.value.userID){const t=JSON.parse(e.index.getStorageSync("userInfo")).userId;a.getUserInfo(t).then((e=>{s.value=JSON.parse(e.liked).includes(v.value.releaseID),n.value=e.follow.includes(v.value.userID)}))}}catch(i){console.log(i)}})),e.onShow((()=>{try{if(v.value.userID){const t=JSON.parse(e.index.getStorageSync("userInfo")).userId;a.getUserInfo(t).then((e=>{s.value=JSON.parse(e.liked).includes(v.value.releaseID),n.value=e.follow.includes(v.value.userID)}))}}catch(t){console.log(t)}})),(a,i)=>e.e({a:v.value.pictures.length>0&&0===v.value.videos.length},v.value.pictures.length>0&&0===v.value.videos.length?{b:e.f(v.value.pictures,((t,a,i)=>({a:t,b:e.o((e=>_(v.value.pictures,a)),"pic-"+a),c:"pic-"+a})))}:{c:e.f(v.value.videos,((t,a,i)=>({a:t,b:"video-"+a,c:e.o(b,"vid-"+a),d:e.o(x,"vid-"+a),e:"vid-"+a}))),d:v.value.cover,e:e.f(v.value.pictures,((t,a,i)=>({a:t,b:e.o((e=>_(v.value.pictures,a)),"pic-"+a),c:"pic-"+a})))},{f:e.t(v.value.title),g:s.value?"red":"white",h:e.o(h),i:v.value.avatar,j:e.o(I),k:e.t(v.value.userName),l:e.o(I),m:e.t(v.value.createdAt.slice(0,10)),n:e.o(I),o:!n.value},n.value?{r:t._imports_5,s:e.o(w)}:{p:t._imports_0,q:e.o(w)},{t:e.t(v.value.content),v:t._imports_2,w:e.t(v.value.location),x:t._imports_3$1,y:e.o((e=>u.value=!0)),z:t._imports_1$1,A:e.t(v.value.money),B:t._imports_2$1,C:e.t(v.value.personNum),D:t._imports_1$2,E:e.t(v.value.playTime),F:u.value},u.value?e.e({G:r.value.length>0},r.value.length>0?{H:t._imports_7,I:e.o(f)}:{},{J:r.value.length>0},r.value.length>0?{K:t._imports_8,L:e.o(m)}:{},{M:t._imports_4,N:e.o((e=>u.value=!1)),O:0===r.value.length},0===r.value.length?{P:e.f(p.value,((t,a,i)=>({a:d.value.find((e=>e===t.id))?t.selectedImage:t.image,b:e.t(t.title),c:t.id,d:d.value.find((e=>e===t.id))?"#FFA07A":"#b6b6b635",e:d.value.find((e=>e===t.id))?"white":"#999",f:e.o((e=>(e=>{let t=d.value.indexOf(e);-1!==t?d.value.splice(t,1):d.value.push(e)})(t.id)),t.id)})))}:{},{Q:0===r.value.length},0===r.value.length?{R:c.value,S:e.o((e=>c.value=e.detail.value)),T:e.o(g)}:{U:e.t(r.value)}):{})}});l.__runtimeHooks=6;const o=e._export_sfc(l,[["__scopeId","data-v-22bb8147"]]);wx.createPage(o);
