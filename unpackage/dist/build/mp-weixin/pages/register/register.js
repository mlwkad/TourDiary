"use strict";const e=require("../../common/vendor.js"),a=require("../../api/api.js"),s=require("../../utils/filter.js"),r=e.defineComponent({__name:"register",setup(r){const i=e.ref(""),n=e.ref(""),o=e.ref(""),t=e.ref(""),l=e.ref("/static/public/defaultAvatar.png"),u=e.reactive({username:"",confirmUsername:"",password:"",confirmPassword:""}),c=async()=>{if(!(()=>{let e=!0;for(let s in u)u[s]="";const a=s.validateUsername(i.value);a.isValid?i.value=a.filteredText:(u.username=a.message,e=!1);const r=s.validateUsername(n.value);r.isValid?n.value=r.filteredText:(u.confirmUsername=r.message,e=!1);const l=s.validatePassword(o.value);l.isValid||(u.password=l.message,e=!1);const c=s.validatePassword(t.value);return c.isValid?o.value!==t.value&&(u.confirmPassword="两次输入的密码不一致",e=!1):(u.confirmPassword=c.message,e=!1),e})())return;e.index.showLoading({title:"注册中..."});const r=await a.uploadFiles(l.value,"image");l.value=r.pictures[0];const c={nickName:i.value,avatarUrl:"",userId:""};try{const s=await a.signUp({userName:i.value,passWord:o.value,avatar:l.value});c.nickName=i.value,c.avatarUrl=l.value,c.userId=s.userID,e.index.setStorageSync("token",s.userID),e.index.setStorageSync("userInfo",JSON.stringify(c)),e.index.hideLoading(),e.index.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>{e.index.navigateBack()}),1e3)}catch(d){console.log(d),e.index.hideLoading(),e.index.showToast({title:"注册失败，请稍后重试",icon:"none"})}},d=()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{l.value=e.tempFilePaths}})},m=()=>{e.index.navigateBack()};return e.onShow((()=>{l.value="/static/public/defaultAvatar.png"})),(a,s)=>e.e({a:l.value,b:e.o(d),c:e.o([e=>i.value=e.detail.value,e=>u.username=""]),d:i.value,e:u.username},u.username?{f:e.t(u.username)}:{},{g:e.o([e=>n.value=e.detail.value,e=>u.confirmUsername=""]),h:n.value,i:u.confirmUsername},u.confirmUsername?{j:e.t(u.confirmUsername)}:{},{k:e.o([e=>o.value=e.detail.value,e=>u.password=""]),l:o.value,m:u.password},u.password?{n:e.t(u.password)}:{},{o:e.o([e=>t.value=e.detail.value,e=>u.confirmPassword=""]),p:t.value,q:u.confirmPassword},u.confirmPassword?{r:e.t(u.confirmPassword)}:{},{s:e.o(m),t:e.o(c)})}}),i=e._export_sfc(r,[["__scopeId","data-v-8afd1c48"]]);wx.createPage(i);
