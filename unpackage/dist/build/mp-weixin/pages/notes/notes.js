"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),s=require("../../api/api.js"),a=e.defineComponent({__name:"notes",setup(a){const o=e.ref([]);e.ref(!1);const n=JSON.parse(e.index.getStorageSync("userInfo")).userId,r=e.ref(!1),i=e.ref("");let c=e.ref("resolve"),l=e.ref("通过");const u=()=>{e.index.reLaunch({url:"/pages/Release/Release"})};return e.onLoad((async()=>{const e=await s.getUserReleases(n);o.value=e})),e.onShow((async()=>{const e=await s.getUserReleases(n);o.value=e})),(a,v)=>e.e({a:o.value.length>0},o.value.length>0?{b:e.f(o.value,((a,u,v)=>{return e.e({a:e.t(a.title),b:e.o((t=>{return r=a,void e.index.showModal({title:"提示",content:"确定要删除这个笔记吗？",success:async t=>{if(t.confirm)try{await s.deleteRelease(r.releaseID,n),e.index.showToast({title:"已删除",icon:"success"});const t=await s.getUserReleases(n);o.value=t}catch(a){console.log(a),e.index.showToast({title:"删除失败",icon:"none"})}}});var r}),u),c:"resolve"!==a.state},"resolve"!==a.state?{d:e.o((t=>{return s=a,void e.index.navigateTo({url:`/pages/notes/note-edit?info=${encodeURIComponent(JSON.stringify(s))}`});var s}),u)}:{},{e:e.t((g=a.state,"resolve"===g?"已通过":"reject"===g?"未通过":"待审核")),f:"reject"===a.state},"reject"===a.state?{g:e.t(a.reason),h:e.o((e=>{return t=a.reason,i.value=t,void(r.value=!0);var t}),u)}:{},{i:(d=a.state,"wait"===d?"rgba(255, 204, 0, 0.7)":"resolve"===d?"rgba(0, 128, 0, 0.637)":"reject"===d?"rgba(219, 6, 6, 0.516)":"rgba(255, 204, 0, 0.7)"),j:e.o((t=>(async t=>{try{await s.updateState(t.releaseID,{state:c.value,reason:l.value}),e.index.showToast({title:"状态已更新",icon:"success"});const a=await s.getUserReleases(n);o.value=a}catch(a){console.log(a),e.index.showToast({title:"更新状态失败",icon:"none"})}})(a)),u),k:a.content},a.content?{l:e.t(a.content)}:{},{m:a.location},a.location?{n:t._imports_1$1,o:e.t(a.location)}:{},{p:e.t(a.createdAt.slice(0,10)),q:a.pictures&&a.pictures.length},a.pictures&&a.pictures.length?{r:e.f(a.pictures,((t,s,o)=>({a:s,b:t,c:e.o((t=>((t,s)=>{const a=t.map((e=>String(e)));e.index.previewImage({urls:a,current:t[s]})})(a.pictures,s)),s)})))}:{},{s:u,t:e.o((t=>(async(t,a)=>{if("resolve"===a)try{const a=await s.getReleaseDetail(t);e.index.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(a))}`})}catch(o){console.log(o),e.index.showToast({title:"获取详情失败",icon:"none"})}else e.index.showToast({title:"笔记未通过,请继续编辑",icon:"none"})})(a.releaseID,a.state)),u)});var d,g}))}:{c:t._imports_2,d:e.o(u)},{e:t._imports_2$3,f:e.o(u),g:r.value},r.value?{h:e.t(i.value),i:e.o((e=>r.value=!1)),j:e.o((()=>{})),k:e.o((e=>r.value=!1))}:{})}}),o=e._export_sfc(a,[["__scopeId","data-v-4f3b8114"]]);wx.createPage(o);
