"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a=require("../../api/api.js"),s=e.defineComponent({__name:"notes",setup(s){const o=e.ref([]),n=e.ref(!1),r=JSON.parse(e.index.getStorageSync("userInfo")).userId,i=e.ref(!1),l=e.ref("");let c=e.ref("resolve"),u=e.ref("通过");const v=()=>{e.index.reLaunch({url:"/pages/Release/Release"})},d=async()=>{n.value=!0;const e=await a.getUserReleases(r);o.value=e,n.value=!1};return e.onLoad((async()=>{const e=await a.getUserReleases(r);o.value=e})),e.onShow((async()=>{const e=await a.getUserReleases(r);o.value=e})),(s,g)=>e.e({a:o.value.length>0},o.value.length>0?{b:e.f(o.value,((s,n,v)=>{return e.e({a:e.t(s.title),b:e.o((t=>{return n=s,void e.index.showModal({title:"提示",content:"确定要删除这个笔记吗？",success:async t=>{if(t.confirm)try{await a.deleteRelease(n.releaseID,r),e.index.showToast({title:"已删除",icon:"success"});const t=await a.getUserReleases(r);o.value=t}catch(s){console.log(s),e.index.showToast({title:"删除失败",icon:"none"})}}});var n}),n),c:"resolve"!==s.state},"resolve"!==s.state?{d:e.o((t=>{return a=s,void e.index.navigateTo({url:`/pages/notes/note-edit?info=${encodeURIComponent(JSON.stringify(a))}`});var a}),n)}:{},{e:e.t((g=s.state,"resolve"===g?"已通过":"reject"===g?"未通过":"待审核")),f:"reject"===s.state},"reject"===s.state?{g:e.t(s.reason),h:e.o((e=>{return t=s.reason,l.value=t,void(i.value=!0);var t}),n)}:{},{i:(d=s.state,"wait"===d?"rgba(255, 204, 0, 0.7)":"resolve"===d?"rgba(0, 128, 0, 0.637)":"reject"===d?"rgba(219, 6, 6, 0.516)":"rgba(255, 204, 0, 0.7)"),j:e.o((t=>(async t=>{try{await a.updateState(t.releaseID,{state:c.value,reason:u.value}),e.index.showToast({title:"状态已更新",icon:"success"});const s=await a.getUserReleases(r);o.value=s}catch(s){console.log(s),e.index.showToast({title:"更新状态失败",icon:"none"})}})(s)),n),k:s.content},s.content?{l:e.t(s.content)}:{},{m:s.location},s.location?{n:t._imports_1$1,o:e.t(s.location)}:{},{p:e.t(s.createdAt.slice(0,10)),q:s.pictures&&s.pictures.length},s.pictures&&s.pictures.length?{r:e.f(s.pictures,((t,a,o)=>({a:a,b:t,c:e.o((t=>((t,a)=>{const s=t.map((e=>String(e)));e.index.previewImage({urls:s,current:t[a]})})(s.pictures,a)),a)})))}:{},{s:n,t:e.o((t=>(async(t,s)=>{if("resolve"===s)try{const s=await a.getReleaseDetail(t);e.index.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(s))}`})}catch(o){console.log(o),e.index.showToast({title:"获取详情失败",icon:"none"})}else e.index.showToast({title:"笔记未通过,请继续编辑",icon:"none"})})(s.releaseID,s.state)),n)});var d,g}))}:{c:t._imports_2,d:e.o(v)},{e:e.o(d),f:n.value,g:t._imports_2$3,h:e.o(v),i:i.value},i.value?{j:e.t(l.value),k:e.o((e=>i.value=!1)),l:e.o((()=>{})),m:e.o((e=>i.value=!1))}:{})}}),o=e._export_sfc(s,[["__scopeId","data-v-6a305a4d"]]);wx.createPage(o);
