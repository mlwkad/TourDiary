"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a=require("../../api/api.js"),o=e.defineComponent({__name:"notes",setup(o){const s=e.ref([]);e.ref(!1);const n=JSON.parse(e.index.getStorageSync("userInfo")).userId,r=e.ref(!1),i=e.ref("");let l=e.ref("555"),c=e.ref("555");const u=()=>{e.index.reLaunch({url:"/pages/Release/Release"})};return e.onLoad((async()=>{const e=await a.getUserReleases(n);s.value=e})),e.onShow((async()=>{const e=await a.getUserReleases(n);s.value=e})),(o,v)=>e.e({a:e.unref(l),b:e.o((t=>e.isRef(l)?l.value=t.detail.value:l=t.detail.value)),c:e.unref(c),d:e.o((t=>e.isRef(c)?c.value=t.detail.value:c=t.detail.value)),e:s.value.length>0},s.value.length>0?{f:e.f(s.value,((o,u,v)=>{return e.e({a:e.t(o.title),b:e.o((t=>{return r=o,void e.index.showModal({title:"提示",content:"确定要删除这个笔记吗？",success:async t=>{if(t.confirm)try{await a.deleteRelease(r.releaseID,n),e.index.showToast({title:"已删除",icon:"success"});const t=await a.getUserReleases(n);s.value=t}catch(o){console.log(o),e.index.showToast({title:"删除失败",icon:"none"})}}});var r}),u),c:"resolve"!==o.state},"resolve"!==o.state?{d:e.o((t=>{return a=o,void e.index.navigateTo({url:`/pages/notes/note-edit?info=${encodeURIComponent(JSON.stringify(a))}`});var a}),u)}:{},{e:e.t((g=o.state,"resolve"===g?"已通过":"reject"===g?"未通过":"待审核")),f:"reject"===o.state},"reject"===o.state?{g:e.t(o.reason),h:e.o((e=>{return t=o.reason,i.value=t,void(r.value=!0);var t}),u)}:{},{i:(d=o.state,"wait"===d?"rgba(255, 204, 0, 0.7)":"resolve"===d?"rgba(0, 128, 0, 0.637)":"reject"===d?"rgba(219, 6, 6, 0.516)":"rgba(255, 204, 0, 0.7)"),j:e.o((t=>(async t=>{try{await a.updateState(t.releaseID,{state:l.value,reason:c.value}),e.index.showToast({title:"状态已更新",icon:"success"});const o=await a.getUserReleases(n);s.value=o}catch(o){console.log(o),e.index.showToast({title:"更新状态失败",icon:"none"})}})(o)),u),k:o.content},o.content?{l:e.t(o.content)}:{},{m:o.location},o.location?{n:t._imports_2$1,o:e.t(o.location)}:{},{p:e.t(o.createdAt.slice(0,10)),q:o.pictures&&o.pictures.length},o.pictures&&o.pictures.length?{r:e.f(o.pictures,((t,a,s)=>({a:a,b:t,c:e.o((t=>((t,a)=>{const o=t.map((e=>String(e)));e.index.previewImage({urls:o,current:t[a]})})(o.pictures,a)),a)})))}:{},{s:u,t:e.o((t=>(async(t,o)=>{if("resolve"===o)try{const o=await a.getReleaseDetail(t);e.index.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(o))}`})}catch(s){console.log(s),e.index.showToast({title:"获取详情失败",icon:"none"})}else e.index.showToast({title:"笔记未通过,请继续编辑",icon:"none"})})(o.releaseID,o.state)),u)});var d,g}))}:{g:t._imports_3,h:e.o(u)},{i:t._imports_2$4,j:e.o(u),k:r.value},r.value?{l:e.t(i.value),m:e.o((e=>r.value=!1)),n:e.o((()=>{})),o:e.o((e=>r.value=!1))}:{})}}),s=e._export_sfc(o,[["__scopeId","data-v-870f519f"]]);wx.createPage(s);
