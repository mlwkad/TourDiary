"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),o=require("../../api/api.js"),s=e.defineComponent({__name:"works",setup(s){const a=e.reactive({});let n=e.ref("");const i=e.ref(!0),l=e.ref([]),c=async()=>{if(n.value=JSON.parse(e.index.getStorageSync("userInfo")).userId,i.value)e.index.showModal({title:"提示",content:`确定要取消关注"${a.userName}"吗？`,success:async t=>{if(t.confirm)try{await o.unfollow(n.value,a.userID),i.value=!1,e.index.showToast({title:"已取消关注",icon:"success"})}catch(s){console.log(s),e.index.showToast({title:"操作失败",icon:"none"})}}});else try{await o.follow(n.value,{followUserID:a.userID}),i.value=!0,e.index.showToast({title:"关注成功",icon:"success"})}catch(t){console.log(t),e.index.showToast({title:"关注失败",icon:"none"})}};return e.onLoad((async t=>{if(t.userID)try{const[s,n]=await Promise.all([o.getUserReleases(t.userID),o.getUserInfo(t.userID)]);l.value=s,Object.assign(a,n);const c=e.index.getStorageSync("userInfo");if(c){const e=await o.getFollowingList(JSON.parse(c).userId);i.value=e.includes(t.userID)}}catch(s){console.log(s),e.index.showToast({title:"获取数据失败",icon:"none"})}})),(s,n)=>e.e({a:t._imports_0,b:e.t(a.userName),c:e.t(l.value.length),d:e.t(i.value?"已关注":"+ 关注"),e:e.o(c),f:l.value.length>0},l.value.length>0?e.e({g:e.f(l.value,((s,a,n)=>e.e({a:e.t(s.title),b:e.t(s.content),c:s.createdAt},s.createdAt?{d:t._imports_1$1,e:e.t(s.createdAt.slice(0,10))}:{},{f:s.location},s.location?{g:t._imports_2$1,h:e.t(s.location)}:{},{i:a,j:e.o((t=>(async t=>{try{const s=await o.getReleaseDetail(t);e.index.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(s))}`})}catch(s){console.log(s),e.index.showToast({title:"获取详情失败",icon:"none"})}})(s.releaseID)),a)}))),h:t._imports_0,i:l.value.length>5},(l.value.length,{})):{j:t._imports_3})}}),a=e._export_sfc(s,[["__scopeId","data-v-a0518728"]]);wx.createPage(a);
