"use strict";const e=require("../../common/vendor.js"),s=require("../../common/assets.js"),a=require("../../api/api.js"),i=e.defineComponent({__name:"login",setup(i){const t=e.ref(""),n=e.ref(""),o=e.reactive({username:"",password:""}),r=()=>{if(!(()=>{let e=!0;const s=(a=t.value).trim()?a.length<3?{isValid:!1,message:"用户名不能少于3个字符"}:a.length>20?{isValid:!1,message:"用户名不能超过20个字符"}:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/.test(a)?{isValid:!0,message:""}:{isValid:!1,message:"用户名只能包含字母、数字、下划线和中文"}:{isValid:!1,message:"用户名不能为空"};var a;s.isValid||(o.username=s.message,e=!1);const i=(r=n.value)?r.length<6?{isValid:!1,message:"密码不能少于6个字符"}:r.length>20?{isValid:!1,message:"密码不能超过20个字符"}:{isValid:!0,message:""}:{isValid:!1,message:"密码不能为空"};var r;return i.isValid||(o.password=i.message,e=!1),e})())return;e.index.showLoading({title:"登录中..."});const s={nickName:t.value,avatarUrl:"/static/666.jpg",userId:"12345"};try{a.checkLogin({userName:t.value,passWord:n.value}).then((async a=>{await new Promise((s=>{e.index.hideLoading(),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{s()}),1e3)})),s.userId=a.userID,s.nickName=t.value,s.avatarUrl="/static/666.jpg",await e.index.setStorageSync("token",a.userID),await e.index.setStorageSync("userInfo",JSON.stringify(s)),e.index.navigateBack()})).catch((s=>{console.log(s),e.index.hideLoading(),e.index.showToast({title:"登录失败，请检查用户名和密码",icon:"none"})}))}catch(i){console.log(i),e.index.hideLoading(),e.index.showToast({title:"登录失败，请稍后重试",icon:"none"})}},d=()=>{e.index.navigateTo({url:"/pages/register/register"})};return(a,i)=>e.e({a:s._imports_0$2,b:e.o([e=>t.value=e.detail.value,e=>o.username=""]),c:t.value,d:o.username},o.username?{e:e.t(o.username)}:{},{f:e.o([e=>n.value=e.detail.value,e=>o.password=""]),g:n.value,h:o.password},o.password?{i:e.t(o.password)}:{},{j:e.o(d),k:e.o(r)})}}),t=e._export_sfc(i,[["__scopeId","data-v-92614419"]]);wx.createPage(t);
