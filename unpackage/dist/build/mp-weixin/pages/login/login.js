"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),s=require("../../api/api.js"),i=e.defineComponent({__name:"login",setup(i){const n=e.ref(""),t=e.ref(""),r=e.reactive({username:"",password:""}),o=()=>{if(!(()=>{let e=!0;const a=(s=n.value).trim()?s.length<3?{isValid:!1,message:"用户名不能少于3个字符"}:s.length>20?{isValid:!1,message:"用户名不能超过20个字符"}:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/.test(s)?{isValid:!0,message:""}:{isValid:!1,message:"用户名只能包含字母、数字、下划线和中文"}:{isValid:!1,message:"用户名不能为空"};var s;a.isValid||(r.username=a.message,e=!1);const i=(o=t.value)?o.length<6?{isValid:!1,message:"密码不能少于6个字符"}:o.length>20?{isValid:!1,message:"密码不能超过20个字符"}:{isValid:!0,message:""}:{isValid:!1,message:"密码不能为空"};var o;return i.isValid||(r.password=i.message,e=!1),e})())return;e.index.showLoading({title:"登录中..."});const a={nickName:n.value,avatarUrl:"/static/666.jpg",userId:"12345"};try{s.checkLogin({userName:n.value,passWord:t.value}).then((async s=>{await new Promise((a=>{e.index.hideLoading(),e.index.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{a()}),1e3)})),a.userId=s.userID,a.nickName=n.value,a.avatarUrl=s.avatar,await e.index.setStorageSync("token",s.userID),await e.index.setStorageSync("userInfo",JSON.stringify(a)),e.index.reLaunch({url:"/pages/index/index"})})).catch((a=>{console.log(a),e.index.hideLoading(),e.index.showToast({title:"登录失败，请检查用户名和密码",icon:"none"})}))}catch(i){console.log(i),e.index.hideLoading(),e.index.showToast({title:"登录失败，请稍后重试",icon:"none"})}},d=()=>{e.index.navigateTo({url:"/pages/register/register"})};return(s,i)=>e.e({a:a._imports_0$3,b:e.o([e=>n.value=e.detail.value,e=>r.username=""]),c:n.value,d:r.username},r.username?{e:e.t(r.username)}:{},{f:e.o([e=>t.value=e.detail.value,e=>r.password=""]),g:t.value,h:r.password},r.password?{i:e.t(r.password)}:{},{j:e.o(d),k:e.o(o)})}}),n=e._export_sfc(i,[["__scopeId","data-v-65a24f76"]]);wx.createPage(n);
