"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),l=require("../../api/api.js"),t=require("../../utils/filter.js"),s=e.defineComponent({__name:"index",setup(s){let o=e.ref(""),u=e.ref(!1),r=e.ref(!1),n=e.ref(!1),i=e.ref(1),c=e.ref(0),v=e.ref(!0),f=e.ref("");const d=e.ref([[],[]]),g=e.ref([[],[]]),m=e.ref([[],[]]),h=(e,a)=>{const l=e.length;if(0===l)return a[0]=[],void(a[1]=[]);if(l<14||l>14){const t=Math.ceil(l/2);a[0]=e.slice(0,t),a[1]=e.slice(t)}else a[0]=e.slice(0,7),a[1]=e.slice(7,14)};e.watchEffect((async()=>{if(!o.value){try{const e=await l.getAllReleases(14,0);h(e.releases||[],d.value)}catch(e){console.log(e)}n.value=!1,v.value=!0}}));const p=async()=>{f.value="";const e=t.validateSearch(o.value);if(e.isValid){o.value=e.filteredText;try{const e=await l.searchReleases({userName:o.value,title:o.value});n.value=!0,v.value=!1,h(e.byUserName||[],g.value),h(e.byTitle||[],m.value),e.byUserName.length>0?(d.value=g.value,r.value=!1):e.byTitle.length>0?(d.value=m.value,r.value=!0):f.value="未找到相关内容"}catch(a){console.log(a),f.value="搜索失败，请稍后再试"}}else f.value=e.message},y=()=>{e.index.pageScrollTo({scrollTop:0,duration:300})},_=async a=>{if(1===a&&1!==i.value){c.value-=14;try{const e=await l.getAllReleases(14,c.value);h(e.releases||[],d.value),y(),i.value--}catch(t){console.log(t),e.index.showToast({title:"获取数据失败",icon:"none"})}}else if(2===a){c.value+=14;try{const e=await l.getAllReleases(14,c.value);h(e.releases||[],d.value),y(),i.value++}catch(t){console.log(t),e.index.showToast({title:"获取数据失败",icon:"none"})}}};return e.onShow((async()=>{try{const e=await l.getAllReleases(14,0);h(e.releases||[],d.value)}catch(e){console.log(e)}o.value=""})),e.onReachBottom((()=>{})),e.onPageScroll((e=>{e.scrollTop>300?u.value=!0:u.value=!1})),(l,t)=>e.e({a:a._imports_3,b:e.unref(o),c:e.o((a=>e.isRef(o)?o.value=a.detail.value:o=a.detail.value)),d:e.o(p),e:e.unref(f)},e.unref(f)?{f:e.t(e.unref(f))}:{},{g:e.unref(n)},e.unref(n)?e.e({h:g.value[0][0]},g.value[0][0]?{i:e.unref(r)?"":1,j:e.o((a=>(e.isRef(r)?r.value=!1:r=!1,d.value=g.value)))}:{},{k:m.value[0][0]},m.value[0][0]?{l:e.unref(r)?1:"",m:e.o((a=>(e.isRef(r)?r.value=!0:r=!0,d.value=m.value)))}:{}):{},{n:e.f(2,((a,l,t)=>({a:e.f(d.value[a-1],((a,l,t)=>({a:a.pictures[0],b:e.t(a.title),c:e.t(a.userName),d:a.name,e:e.o((l=>{return t=a,void e.index.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(t))}`});var t}),a.name)}))),b:l}))),o:a._imports_0,p:e.unref(v)},e.unref(v)?{q:e.o((e=>_(1))),r:e.t(e.unref(i)),s:e.o((e=>_(2)))}:{},{t:e.unref(u)},e.unref(u)?{v:e.o(y),w:a._imports_2}:{})}});s.__runtimeHooks=1;const o=e._export_sfc(s,[["__scopeId","data-v-a66f7246"]]);wx.createPage(o);
