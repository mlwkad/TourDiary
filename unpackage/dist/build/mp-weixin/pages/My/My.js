"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../api/api.js"),s=e.defineComponent({__name:"My",setup(s){let t=e.ref(!1);const n=e.ref(!1),r=e.reactive({nickName:"",avatarUrl:"",userId:""}),i=e.ref(0),c=e.ref(0),l=e.ref(0),u=async()=>{if(e.index.getStorageSync("token")){n.value=!0;const a=e.index.getStorageSync("userInfo");a&&Object.assign(r,JSON.parse(a));const s=await o.getUserInfo(r.userId);i.value=JSON.parse(s.release).length,c.value=JSON.parse(s.follow).length,l.value=JSON.parse(s.liked).length}},d=()=>{e.index.navigateTo({url:"/pages/login/login"})},v=()=>{e.index.navigateTo({url:"/pages/register/register"})},m=()=>{e.index.showModal({title:"提示",content:"确定要退出登录吗？",success:a=>{a.confirm&&(e.index.removeStorageSync("token"),e.index.removeStorageSync("userInfo"),n.value=!1,Object.assign(r,{nickName:"",avatarUrl:"",userId:""}),e.index.showToast({title:"已退出登录",icon:"success"}))}})},g=()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{try{const a=await o.uploadFiles(e.tempFilePaths,"image");r.avatarUrl=a.pictures[0]}catch(a){console.log(a)}}})},p=async()=>{try{await o.updateUserInfo(r.userId,{userID:r.userId,userName:r.nickName,avatar:r.avatarUrl}),e.index.setStorageSync("userInfo",JSON.stringify(r)),t.value=!1,e.index.showToast({title:"修改成功",icon:"success"})}catch(a){console.log(a),e.index.showToast({title:"修改失败",icon:"none"})}},f=a=>{n.value?"follow"!==a?e.index.navigateTo({url:`/pages/${a}/${a}`}):e.index.navigateTo({url:`/pages/${a}/list`}):e.index.showModal({title:"提示",content:"请先登录",success:e=>{e.confirm&&d()}})};return e.onLoad((()=>{u()})),e.onShow((()=>{u()})),(o,s)=>e.e({a:n.value},n.value?{b:r.avatarUrl,c:e.t(r.nickName||"用户"),d:a._imports_0$2,e:e.o((a=>e.isRef(t)?t.value=!0:t=!0))}:{f:a._imports_1$3,g:e.o(d),h:e.o(v)},{i:n.value?1:"",j:a._imports_2$2,k:e.t(l.value),l:e.o((e=>f("collection"))),m:a._imports_3$1,n:e.t(i.value),o:e.o((e=>f("notes"))),p:a._imports_4$1,q:e.t(c.value),r:e.o((e=>f("follow"))),s:a._imports_5,t:a._imports_6,v:e.o((e=>f("feedback"))),w:n.value},n.value?{x:e.o(m)}:{},{y:e.unref(t)},e.unref(t)?{z:a._imports_4,A:e.o((a=>e.isRef(t)?t.value=!1:t=!1)),B:r.avatarUrl,C:e.o(g),D:r.nickName,E:r.nickName,F:e.o((e=>r.nickName=e.detail.value)),G:e.o(p)}:{})}}),t=e._export_sfc(s,[["__scopeId","data-v-9e3106d7"]]);wx.createPage(t);
