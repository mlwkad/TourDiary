"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../api/api.js"),s=e.defineComponent({__name:"My",setup(s){let t=e.ref(!1);const n=e.ref(!1),i=e.reactive({nickName:"",avatarUrl:"",userId:""}),r=()=>{if(e.index.getStorageSync("token")){n.value=!0;const a=e.index.getStorageSync("userInfo");a&&Object.assign(i,JSON.parse(a))}},c=()=>{e.index.navigateTo({url:"/pages/login/login"})},l=()=>{e.index.navigateTo({url:"/pages/register/register"})},u=()=>{e.index.showModal({title:"提示",content:"确定要退出登录吗？",success:a=>{a.confirm&&(e.index.removeStorageSync("token"),e.index.removeStorageSync("userInfo"),n.value=!1,Object.assign(i,{nickName:"",avatarUrl:"",userId:""}),e.index.showToast({title:"已退出登录",icon:"success"}))}})},m=()=>{e.index.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{try{const a=await o.uploadFiles(e.tempFilePaths,"image");i.avatarUrl=a.pictures[0]}catch(a){console.log(a)}}})},d=async()=>{try{await o.updateUserInfo(i.userId,{userID:i.userId,userName:i.nickName,avatar:i.avatarUrl}),e.index.setStorageSync("userInfo",JSON.stringify(i)),t.value=!1,e.index.showToast({title:"修改成功",icon:"success"})}catch(a){console.log(a),e.index.showToast({title:"修改失败",icon:"none"})}},v=a=>{n.value?"follow"!==a?e.index.navigateTo({url:`/pages/${a}/${a}`}):e.index.navigateTo({url:`/pages/${a}/list`}):e.index.showModal({title:"提示",content:"请先登录",success:e=>{e.confirm&&c()}})};return e.onLoad((()=>{r()})),e.onShow((()=>{r()})),(o,s)=>e.e({a:n.value},n.value?{b:i.avatarUrl,c:e.t(i.nickName||"用户"),d:a._imports_0$1,e:e.o((a=>e.isRef(t)?t.value=!0:t=!0))}:{f:a._imports_1$3,g:e.o(c),h:e.o(l)},{i:n.value?1:"",j:a._imports_2$2,k:a._imports_3$2,l:e.o((e=>v("collection"))),m:a._imports_4$1,n:a._imports_3$2,o:e.o((e=>v("notes"))),p:a._imports_5,q:a._imports_3$2,r:e.o((e=>v("follow"))),s:n.value},n.value?{t:e.o(u)}:{},{v:e.unref(t)},e.unref(t)?{w:a._imports_4,x:e.o((a=>e.isRef(t)?t.value=!1:t=!1)),y:i.avatarUrl,z:e.o(m),A:i.nickName,B:i.nickName,C:e.o((e=>i.nickName=e.detail.value)),D:e.o(d)}:{})}}),t=e._export_sfc(s,[["__scopeId","data-v-181f0b52"]]);wx.createPage(t);
