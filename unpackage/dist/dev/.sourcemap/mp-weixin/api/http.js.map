{"version":3,"file":"http.js","sources":["api/http.js"],"sourcesContent":["let baseUrl = ''\r\n\r\n// 判断环境\r\nif (process.env.NODE_ENV === 'development') {\r\n    // 开发环境(最新),后端开启,sealos的关联DevBox开机,功能稳定后迭代到生产环境(直接生成新版本)\r\n    baseUrl = 'https://vkxvigkepssq.sealosbja.site'\r\n} else {\r\n    // 生产环境\r\n    baseUrl = 'https://ovmmqfovxbil.sealosbja.site'\r\n}\r\n\r\nconst throttleMap = new Map()\r\n\r\nexport default function http(url, data = {}, method = 'GET') {\r\n    // // 节流处理\r\n    // const key = `${url}-${method}`\r\n    // const now = Date.now() // 毫秒级时间戳\r\n    // if (throttleMap.has(key)) {\r\n    //     if (now - throttleMap.get(key) < 1000) {\r\n    //         console.log(now, throttleMap.get(key))\r\n    //         console.log(now - throttleMap.get(key))\r\n    //         uni.showToast({\r\n    //             title: '请求过于频繁',\r\n    //             icon: 'none'\r\n    //         })\r\n    //         return\r\n    //     }\r\n    // }\r\n    // throttleMap.set(key, now)\r\n\r\n    return new Promise((resolve, reject) => {\r\n        uni.request({\r\n            url: baseUrl + url,\r\n            data,\r\n            method,\r\n            header: { \r\n                'token': uni.getStorageSync('token') || ''\r\n            },\r\n            success: (res) => {\r\n                if (res.statusCode === 200 || res.statusCode === 201) {  \r\n                    if (res.data.success === true) {  \r\n                        resolve(res.data.data || res.data)\r\n                    }\r\n                    else {\r\n                        uni.showToast({\r\n                            title: res.data.message,\r\n                            icon: 'none'\r\n                        })\r\n                        reject(res.data.message)\r\n                    }\r\n                } else {\r\n                    uni.showToast({\r\n                        title: res.data.message || '请求失败',\r\n                        icon: 'none'\r\n                    })\r\n                    reject(res.data.message)\r\n                }\r\n            },\r\n            fail: (err) => {\r\n                console.log(err)\r\n                uni.showToast({\r\n                    title: '服务请求异常',\r\n                    icon: 'none'\r\n                })\r\n                reject(err)\r\n            }\r\n        })\r\n    })\r\n}\r\n\r\n"],"names":["uni"],"mappings":";;AAAA,IAAI,UAAU;AAG8B;AAE9B,YAAA;AACd;AAOA,SAAwB,KAAK,KAAK,OAAO,CAAA,GAAI,SAAS,OAAO;AAiBzD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCA,kBAAAA,MAAI,QAAQ;AAAA,MACR,KAAK,UAAU;AAAA,MACf;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,QACJ,SAASA,cAAA,MAAI,eAAe,OAAO,KAAK;AAAA,MAC5C;AAAA,MACA,SAAS,CAAC,QAAQ;AACd,YAAI,IAAI,eAAe,OAAO,IAAI,eAAe,KAAK;AAC9C,cAAA,IAAI,KAAK,YAAY,MAAM;AAC3B,oBAAQ,IAAI,KAAK,QAAQ,IAAI,IAAI;AAAA,UAAA,OAEhC;AACDA,0BAAAA,MAAI,UAAU;AAAA,cACV,OAAO,IAAI,KAAK;AAAA,cAChB,MAAM;AAAA,YAAA,CACT;AACM,mBAAA,IAAI,KAAK,OAAO;AAAA,UAC3B;AAAA,QAAA,OACG;AACHA,wBAAAA,MAAI,UAAU;AAAA,YACV,OAAO,IAAI,KAAK,WAAW;AAAA,YAC3B,MAAM;AAAA,UAAA,CACT;AACM,iBAAA,IAAI,KAAK,OAAO;AAAA,QAC3B;AAAA,MACJ;AAAA,MACA,MAAM,CAAC,QAAQ;AACXA,sBAAAA,MAAA,MAAA,OAAA,qBAAY,GAAG;AACfA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACT;AACD,eAAO,GAAG;AAAA,MACd;AAAA,IAAA,CACH;AAAA,EAAA,CACJ;AACL;;"}