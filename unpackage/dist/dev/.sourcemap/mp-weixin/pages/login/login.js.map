{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../uniapp/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n    <view class=\"login-container\">\r\n        <view class=\"login-header\">\r\n            <image class=\"back-icon\" src=\"/static/public/back.png\" @click=\"goBack\"></image>\r\n            <text class=\"header-title\">用户登录</text>\r\n        </view>\r\n\r\n        <view class=\"login-form\">\r\n            <view class=\"avatar-container\">\r\n                <image class=\"avatar\" src=\"/static/666.jpg\" mode=\"aspectFill\"></image>\r\n            </view>\r\n\r\n            <view class=\"input-group\">\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">用户名</text>\r\n                    <input class=\"input-field\" type=\"text\" v-model=\"username\" placeholder=\"请输入用户名\" />\r\n                </view>\r\n\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">密码</text>\r\n                    <input class=\"input-field\" type=\"password\" v-model=\"password\" placeholder=\"请输入密码\" />\r\n                </view>\r\n            </view>\r\n\r\n            <view class=\"login-options\">\r\n                <text class=\"forget-password\" @click=\"forgetPassword\">忘记密码?</text>\r\n                <text class=\"register-link\" @click=\"goToRegister\">没有账号? 去注册</text>\r\n            </view>\r\n\r\n            <button class=\"login-button\" @click=\"handleLogin\">登录</button>\r\n\r\n            <view class=\"wechat-login\">\r\n                <text class=\"wechat-login-text\">微信快速登录</text>\r\n                <button class=\"wechat-login-button\" @click=\"wechatLogin\">\r\n                    <text>微信登录</text>\r\n                </button>\r\n            </view>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue'\r\nimport { getSessionKey, getWXUserInfo, checkLogin } from '../../api/api';\r\n\r\nconst username = ref<string>('')\r\nconst password = ref<string>('')\r\n\r\n// 登录处理\r\nconst handleLogin = () => {\r\n    if (!username.value || !password.value) {\r\n        uni.showToast({\r\n            title: '请输入用户名和密码',\r\n            icon: 'none'\r\n        })\r\n        return\r\n    }\r\n\r\n    uni.showLoading({\r\n        title: '登录中...'\r\n    })\r\n\r\n    const userInfo = {\r\n        nickName: username.value,\r\n        avatarUrl: '/static/666.jpg',\r\n        userId: '12345'\r\n    }\r\n\r\n    try {\r\n        checkLogin({\r\n            userName: username.value,\r\n            passWord: password.value\r\n        }).then(async res => {\r\n            await new Promise(resolve => {\r\n                uni.hideLoading()\r\n                uni.showToast({\r\n                    title: '登录成功',\r\n                    icon: 'success'\r\n                })\r\n                setTimeout(() => {\r\n                    resolve()\r\n                }, 1000)\r\n            })\r\n            uni.__f__('log','at pages/login/login.vue:84',res)\r\n            userInfo.userId = res.userID\r\n            userInfo.nickName = username.value\r\n            userInfo.avatarUrl = '/static/666.jpg'\r\n            // 随便设置一个token\r\n            await uni.setStorageSync('token', 'sample-token')\r\n            await uni.setStorageSync('userInfo', JSON.stringify(userInfo))\r\n            uni.navigateBack()\r\n        }).catch(err => {\r\n            uni.__f__('log','at pages/login/login.vue:93',err)\r\n        })\r\n    } catch (e) {\r\n        uni.__f__('log','at pages/login/login.vue:96',e)\r\n    }\r\n};\r\n\r\n// 用户鉴权\r\nconst wechatLogin = async () => {\r\n    try {\r\n        const modalRes = await new Promise(resolve => {\r\n            uni.showModal({\r\n                title: '温馨提示',\r\n                content: '需要您授权获取个人信息',\r\n                success: resolve\r\n            })\r\n        })\r\n\r\n        if (!modalRes.confirm) return\r\n\r\n        const userProfileRes = await new Promise((resolve, reject) => {\r\n            uni.getUserProfile({\r\n                desc: '需要获取您的微信昵称和头像',\r\n                success: resolve,\r\n                fail: reject\r\n            })\r\n        }).catch(err => {\r\n            uni.__f__('log','at pages/login/login.vue:120','获取用户信息失败', err)\r\n            uni.showToast({ title: '获取用户信息失败', icon: 'none' })\r\n            throw new Error('用户拒绝授权')\r\n        })\r\n\r\n        const { encryptedData, iv } = userProfileRes\r\n\r\n        const loginRes = await new Promise(resolve => {\r\n            uni.login({ success: resolve })\r\n        })\r\n\r\n        try {\r\n            const sessionKeyRes = await getSessionKey('', { code: loginRes })\r\n            const userInfoRes = await getWXUserInfo('', {\r\n                encryptedData,\r\n                iv,\r\n                sessionKey: sessionKeyRes.sessionKey\r\n            }, 'POST')\r\n\r\n            const userInfo = {\r\n                nickName: userInfoRes.nickName,\r\n                avatarUrl: userInfoRes.avatarUrl,\r\n                userId: ''\r\n            }\r\n\r\n            uni.setStorageSync('token', 'wx-token')\r\n            uni.setStorageSync('userInfo', JSON.stringify(userInfo))\r\n\r\n            uni.showToast({ title: '登录成功', icon: 'success' })\r\n            setTimeout(() => uni.navigateBack(), 1000)\r\n        } catch (error) {\r\n            uni.__f__('error','at pages/login/login.vue:151','微信登录失败', error)\r\n            uni.showToast({ title: '登录失败，请稍后重试', icon: 'none' })\r\n        }\r\n    } catch (error) {\r\n        uni.__f__('error','at pages/login/login.vue:155','微信登录过程异常', error)\r\n    }\r\n}\r\n\r\n// 忘记密码\r\nconst forgetPassword = () => {\r\n    uni.showToast({\r\n        title: '忘记密码功能暂未开放',\r\n        icon: 'none'\r\n    })\r\n}\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n    uni.navigateBack()\r\n}\r\n\r\n// 跳转到注册页\r\nconst goToRegister = () => {\r\n    uni.navigateTo({\r\n        url: '/pages/register/register'\r\n    })\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-container {\r\n    background-color: #ffffff;\r\n    min-height: 100vh;\r\n\r\n    .login-header {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 20rpx;\r\n        position: relative;\r\n\r\n        .back-icon {\r\n            width: 40rpx;\r\n            height: 40rpx;\r\n        }\r\n\r\n        .header-title {\r\n            flex: 1;\r\n            text-align: center;\r\n            font-size: 36rpx;\r\n            font-weight: bold;\r\n            color: #333;\r\n        }\r\n    }\r\n\r\n    .login-form {\r\n        padding: 30rpx;\r\n\r\n        .avatar-container {\r\n            display: flex;\r\n            justify-content: center;\r\n            margin: 30rpx 0 50rpx;\r\n\r\n            .avatar {\r\n                width: 180rpx;\r\n                height: 180rpx;\r\n                border-radius: 50%;\r\n                border: 4rpx solid #4bb0ff;\r\n            }\r\n        }\r\n\r\n        .input-group {\r\n            margin-bottom: 40rpx;\r\n\r\n            .input-item {\r\n                margin-bottom: 30rpx;\r\n\r\n                .input-label {\r\n                    font-size: 28rpx;\r\n                    color: #666;\r\n                    margin-bottom: 15rpx;\r\n                    display: block;\r\n                    margin-left: 15rpx;\r\n                }\r\n\r\n                .input-field {\r\n                    width: 91%;\r\n                    height: 80rpx;\r\n                    background-color: #f5f5f5;\r\n                    border-radius: 40rpx;\r\n                    padding: 0 30rpx;\r\n                    font-size: 28rpx;\r\n                }\r\n            }\r\n        }\r\n\r\n        .login-options {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            margin-bottom: 40rpx;\r\n\r\n            .forget-password,\r\n            .register-link {\r\n                font-size: 26rpx;\r\n                color: #4bb0ff;\r\n            }\r\n        }\r\n\r\n        .login-button {\r\n            width: 100%;\r\n            height: 90rpx;\r\n            background: linear-gradient(to right, #4bb0ff, #61e4ff);\r\n            color: #fff;\r\n            font-size: 32rpx;\r\n            font-weight: bold;\r\n            border-radius: 45rpx;\r\n            margin-bottom: 50rpx;\r\n            line-height: 90rpx;\r\n        }\r\n\r\n        .wechat-login {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n\r\n            .wechat-login-text {\r\n                font-size: 28rpx;\r\n                color: #999;\r\n                margin-bottom: 30rpx;\r\n            }\r\n\r\n            .wechat-login-button {\r\n                width: 60%;\r\n                height: 90rpx;\r\n                background-color: #07c160;\r\n                color: #fff;\r\n                font-size: 32rpx;\r\n                font-weight: bold;\r\n                border-radius: 45rpx;\r\n                line-height: 90rpx;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>","import MiniProgramPage from 'D:/uniappProject/旅游日记uniapp/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","checkLogin","getSessionKey","getWXUserInfo"],"mappings":"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"}