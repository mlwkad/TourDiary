{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../uniapp/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n    <view class=\"login-container\">\r\n        <view class=\"login-branding\">\r\n            <image class=\"app-logo\" src=\"/static/public/logo.png\" mode=\"aspectFit\"></image>\r\n            <view class=\"brand-title\">旅游日记</view>\r\n            <view class=\"brand-slogan\">记录旅途，分享精彩</view>\r\n        </view>\r\n        <view class=\"login-form\">\r\n            <view class=\"input-group\">\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">用户名</text>\r\n                    <input class=\"input-field\" type=\"text\" v-model=\"username\" placeholder=\"请输入用户名\"\r\n                        @input=\"errors.username = ''\" />\r\n                    <view class=\"error-text\" v-if=\"errors.username\">{{ errors.username }}</view>\r\n                </view>\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">密码</text>\r\n                    <input class=\"input-field\" type=\"password\" v-model=\"password\" placeholder=\"请输入密码\"\r\n                        @input=\"errors.password = ''\" />\r\n                    <view class=\"error-text\" v-if=\"errors.password\">{{ errors.password }}</view>\r\n                </view>\r\n            </view>\r\n            <view class=\"login-options\">\r\n                <text class=\"register-link\" @click=\"goToRegister\">没有账号? 去注册</text>\r\n            </view>\r\n            <button class=\"login-button\" @click=\"handleLogin\">登录</button>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from 'vue'\r\nimport { checkLogin } from '../../api/api';\r\n\r\nconst username = ref<string>('')\r\nconst password = ref<string>('')\r\n\r\n// 错误信息\r\nconst errors = reactive({\r\n    username: '',\r\n    password: ''\r\n})\r\n\r\n// 验证用户名\r\nconst validateUsername = (username: string) => {\r\n    if (!username.trim()) {\r\n        return { isValid: false, message: '用户名不能为空' }\r\n    }\r\n    if (username.length < 3) {\r\n        return { isValid: false, message: '用户名不能少于3个字符' }\r\n    }\r\n    if (username.length > 20) {\r\n        return { isValid: false, message: '用户名不能超过20个字符' }\r\n    }\r\n    // 检查用户名是否包含非法字符\r\n    const usernamePattern = /^[a-zA-Z0-9_\\u4e00-\\u9fa5]+$/\r\n    if (!usernamePattern.test(username)) {\r\n        return { isValid: false, message: '用户名只能包含字母、数字、下划线和中文' }\r\n    }\r\n    return { isValid: true, message: '' }\r\n}\r\n\r\n// 验证密码\r\nconst validatePassword = (password: string) => {\r\n    if (!password) {\r\n        return { isValid: false, message: '密码不能为空' }\r\n    }\r\n    if (password.length < 6) {\r\n        return { isValid: false, message: '密码不能少于6个字符' }\r\n    }\r\n    if (password.length > 20) {\r\n        return { isValid: false, message: '密码不能超过20个字符' }\r\n    }\r\n    return { isValid: true, message: '' }\r\n}\r\n\r\n// 验证表单\r\nconst validateForm = () => {\r\n    let isValid = true\r\n    // 验证用户名\r\n    const usernameVal = validateUsername(username.value)\r\n    if (!usernameVal.isValid) {\r\n        errors.username = usernameVal.message\r\n        isValid = false\r\n    }\r\n    // 验证密码\r\n    const passwordVal = validatePassword(password.value)\r\n    if (!passwordVal.isValid) {\r\n        errors.password = passwordVal.message\r\n        isValid = false\r\n    }\r\n    return isValid\r\n}\r\n\r\n// 登录处理\r\nconst handleLogin = () => {\r\n    // 验证表单\r\n    if (!validateForm()) {\r\n        return\r\n    }\r\n    uni.showLoading({\r\n        title: '登录中...'\r\n    })\r\n    const userInfo = {\r\n        nickName: username.value,\r\n        avatarUrl: '/static/666.jpg',\r\n        userId: '12345'\r\n    }\r\n    try {\r\n        checkLogin({\r\n            userName: username.value,\r\n            passWord: password.value\r\n        }).then(async res => {\r\n            await new Promise(resolve => {\r\n                uni.hideLoading()\r\n                uni.showToast({\r\n                    title: '登录成功',\r\n                    icon: 'success'\r\n                })\r\n                setTimeout(() => {\r\n                    resolve()\r\n                }, 1000)\r\n            })\r\n            userInfo.userId = res.userID\r\n            userInfo.nickName = username.value\r\n            userInfo.avatarUrl = res.avatar\r\n            await uni.setStorageSync('token', res.userID)\r\n            await uni.setStorageSync('userInfo', JSON.stringify(userInfo))\r\n            uni.reLaunch({\r\n                url: '/pages/index/index'\r\n            })\r\n        }).catch(err => {\r\n            uni.__f__('log','at pages/login/login.vue:133',err)\r\n            uni.hideLoading()\r\n            uni.showToast({\r\n                title: '登录失败，请检查用户名和密码',\r\n                icon: 'none'\r\n            })\r\n        })\r\n    } catch (e) {\r\n        uni.__f__('log','at pages/login/login.vue:141',e)\r\n        uni.hideLoading()\r\n        uni.showToast({\r\n            title: '登录失败，请稍后重试',\r\n            icon: 'none'\r\n        })\r\n    }\r\n}\r\n\r\n// 跳转到注册页\r\nconst goToRegister = () => {\r\n    uni.navigateTo({\r\n        url: '/pages/register/register'\r\n    })\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-container {\r\n    background-color: #ffffff;\r\n    // min-height: 100vh;\r\n\r\n    .login-branding {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        padding: 80rpx 0 40rpx;\r\n        background: linear-gradient(135deg, rgba(52, 148, 230, 0.05), rgba(236, 110, 173, 0.03));\r\n        border-radius: 0 0 30% 30%;\r\n        margin-bottom: 20rpx;\r\n        position: relative;\r\n\r\n        &::after {\r\n            z-index: 999999;\r\n            content: '';\r\n            position: absolute;\r\n            bottom: 0;\r\n            left: 25%;\r\n            width: 50%;\r\n            height: 8rpx;\r\n            background: linear-gradient(to right, transparent, rgba(52, 148, 230, 0.3), rgba(236, 110, 173, 0.3), transparent);\r\n        }\r\n\r\n        .app-logo {\r\n            width: 180rpx;\r\n            height: 180rpx;\r\n            margin-bottom: 30rpx;\r\n        }\r\n\r\n        .brand-title {\r\n            font-size: 48rpx;\r\n            font-weight: bold;\r\n            background: linear-gradient(to right, #3494E6, #EC6EAD);\r\n            -webkit-background-clip: text;\r\n            background-clip: text;\r\n            color: transparent;\r\n            margin-bottom: 16rpx;\r\n        }\r\n\r\n        .brand-slogan {\r\n            font-size: 28rpx;\r\n            color: #888;\r\n            letter-spacing: 2rpx;\r\n        }\r\n    }\r\n\r\n    .login-header {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 20rpx;\r\n        position: relative;\r\n\r\n        .back-icon {\r\n            width: 40rpx;\r\n            height: 40rpx;\r\n        }\r\n\r\n        .header-title {\r\n            flex: 1;\r\n            text-align: center;\r\n            font-size: 36rpx;\r\n            font-weight: bold;\r\n            color: #333;\r\n        }\r\n    }\r\n\r\n    .login-form {\r\n        padding: 30rpx;\r\n\r\n        .avatar-container {\r\n            display: flex;\r\n            justify-content: center;\r\n            margin: 30rpx 0 50rpx;\r\n\r\n            .avatar {\r\n                width: 180rpx;\r\n                height: 180rpx;\r\n                border-radius: 50%;\r\n                border: 4rpx solid #4bb0ff;\r\n            }\r\n        }\r\n\r\n        .input-group {\r\n            margin-bottom: 40rpx;\r\n\r\n            .input-item {\r\n                margin-bottom: 30rpx;\r\n\r\n                .input-label {\r\n                    font-size: 28rpx;\r\n                    color: #666;\r\n                    margin-bottom: 15rpx;\r\n                    display: block;\r\n                    margin-left: 15rpx;\r\n                }\r\n\r\n                .input-field {\r\n                    width: 91%;\r\n                    height: 80rpx;\r\n                    background-color: #f5f5f5;\r\n                    border-radius: 40rpx;\r\n                    padding: 0 30rpx;\r\n                    font-size: 28rpx;\r\n                }\r\n\r\n                .error-text {\r\n                    color: #EC6EAD;\r\n                    font-size: 24rpx;\r\n                    margin: 12rpx 0 0 20rpx;\r\n                    background-color: rgba(236, 110, 173, 0.1);\r\n                    padding: 8rpx 16rpx;\r\n                    border-radius: 10rpx;\r\n                    display: block;\r\n                    width: fit-content;\r\n                    max-width: 90%;\r\n                    word-break: break-all;\r\n                }\r\n            }\r\n        }\r\n\r\n        .login-options {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            margin-bottom: 40rpx;\r\n\r\n            .forget-password,\r\n            .register-link {\r\n                font-size: 26rpx;\r\n                color: #4bb0ff;\r\n            }\r\n        }\r\n\r\n        .login-button {\r\n            width: 100%;\r\n            height: 90rpx;\r\n            background: linear-gradient(to right, #3494E6, #EC6EAD);\r\n            color: #fff;\r\n            font-size: 32rpx;\r\n            font-weight: bold;\r\n            border-radius: 45rpx;\r\n            margin-bottom: 50rpx;\r\n            line-height: 90rpx;\r\n        }\r\n\r\n        .wechat-login {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n\r\n            .wechat-login-text {\r\n                font-size: 28rpx;\r\n                color: #999;\r\n                margin-bottom: 30rpx;\r\n            }\r\n\r\n            .wechat-login-button {\r\n                width: 60%;\r\n                height: 90rpx;\r\n                background-color: #07c160;\r\n                color: #fff;\r\n                font-size: 32rpx;\r\n                font-weight: bold;\r\n                border-radius: 45rpx;\r\n                line-height: 90rpx;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>","import MiniProgramPage from 'D:/uniappProject/旅游日记uniapp/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","username","password","uni","checkLogin"],"mappings":"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"}