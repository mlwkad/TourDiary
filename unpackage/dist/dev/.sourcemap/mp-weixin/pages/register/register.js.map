{"version":3,"file":"register.js","sources":["pages/register/register.vue","../../uniapp/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVnaXN0ZXIvcmVnaXN0ZXIudnVl"],"sourcesContent":["<template>\r\n    <view class=\"register-container\">\r\n        <view class=\"register-form\">\r\n            <view class=\"avatar-container\">\r\n                <image class=\"avatar\" :src=\"avatarUrl\" mode=\"aspectFill\"></image>\r\n                <view class=\"avatar-upload\">\r\n                    <text @click=\"changeAvatar\">点击更换头像</text>\r\n                </view>\r\n            </view>\r\n            <view class=\"input-group\">\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">用户名</text>\r\n                    <input class=\"input-field\" type=\"text\" v-model=\"username\" placeholder=\"请输入用户名\"\r\n                        @input=\"errors.username = ''\" />\r\n                    <view class=\"error-text\" v-if=\"errors.username\">{{ errors.username }}</view>\r\n                </view>\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">确认用户名</text>\r\n                    <input class=\"input-field\" type=\"text\" v-model=\"confirmUsername\" placeholder=\"请再次输入用户名\"\r\n                        @input=\"errors.confirmUsername = ''\" />\r\n                    <view class=\"error-text\" v-if=\"errors.confirmUsername\">{{ errors.confirmUsername }}</view>\r\n                </view>\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">密码</text>\r\n                    <input class=\"input-field\" type=\"password\" v-model=\"password\" placeholder=\"请输入密码\"\r\n                        @input=\"errors.password = ''\" />\r\n                    <view class=\"error-text\" v-if=\"errors.password\">{{ errors.password }}</view>\r\n                </view>\r\n                <view class=\"input-item\">\r\n                    <text class=\"input-label\">确认密码</text>\r\n                    <input class=\"input-field\" type=\"password\" v-model=\"confirmPassword\" placeholder=\"请再次输入密码\"\r\n                        @input=\"errors.confirmPassword = ''\" />\r\n                    <view class=\"error-text\" v-if=\"errors.confirmPassword\">{{ errors.confirmPassword }}</view>\r\n                </view>\r\n            </view>\r\n            <view class=\"register-options\">\r\n                <text class=\"login-link\" @click=\"goToLogin\">已有账号? 去登录</text>\r\n            </view>\r\n            <button class=\"register-button\" @click=\"handleRegister\">注册</button>\r\n        </view>\r\n    </view>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from 'vue'\r\nimport { signUp, uploadFiles } from '../../api/api'\r\nimport { validateUsername, validatePassword } from '../../utils/filter'\r\nimport { onShow } from '@dcloudio/uni-app'\r\n\r\nconst username = ref<string>('')\r\nconst confirmUsername = ref<string>('')\r\nconst password = ref<string>('')\r\nconst confirmPassword = ref<string>('')\r\nconst avatarUrl = ref<string>('/static/public/defaultAvatar.png')\r\n\r\n// 错误信息\r\nconst errors = reactive({\r\n    username: '',\r\n    confirmUsername: '',\r\n    password: '',\r\n    confirmPassword: ''\r\n})\r\n\r\n// 验证表单\r\nconst validateForm = () => {\r\n    let isValid = true\r\n    for (let key in errors) {\r\n        errors[key] = ''\r\n    }\r\n    // 验证用户名\r\n    const usernameVal = validateUsername(username.value)\r\n    if (!usernameVal.isValid) {\r\n        errors.username = usernameVal.message\r\n        isValid = false\r\n    } else {\r\n        username.value = usernameVal.filteredText\r\n    }\r\n    // 验证确认用户名\r\n    const confirmUsernameVal = validateUsername(confirmUsername.value)\r\n    if (!confirmUsernameVal.isValid) {\r\n        errors.confirmUsername = confirmUsernameVal.message\r\n        isValid = false\r\n    } else {\r\n        confirmUsername.value = confirmUsernameVal.filteredText\r\n    }\r\n    // 验证密码\r\n    const passwordVal = validatePassword(password.value)\r\n    if (!passwordVal.isValid) {\r\n        errors.password = passwordVal.message\r\n        isValid = false\r\n    }\r\n    // 验证确认密码\r\n    const confirmPasswordVal = validatePassword(confirmPassword.value)\r\n    if (!confirmPasswordVal.isValid) {\r\n        errors.confirmPassword = confirmPasswordVal.message\r\n        isValid = false\r\n    } else if (password.value !== confirmPassword.value) {\r\n        errors.confirmPassword = '两次输入的密码不一致'\r\n        isValid = false\r\n    }\r\n    return isValid\r\n}\r\n\r\n// 注册处理\r\nconst handleRegister = async () => {\r\n    // 验证表单\r\n    if (!validateForm()) {\r\n        return\r\n    }\r\n    uni.showLoading({\r\n        title: '注册中...'\r\n    })\r\n    const resultAvatar = await uploadFiles(avatarUrl.value, 'image')\r\n    avatarUrl.value = resultAvatar.pictures[0]\r\n    const userInfo = {\r\n        nickName: username.value,\r\n        avatarUrl: '',\r\n        userId: ''\r\n    }\r\n    try {\r\n        const res = await signUp({\r\n            userName: username.value,\r\n            passWord: password.value,\r\n            avatar: avatarUrl.value\r\n        })\r\n        userInfo.nickName = username.value\r\n        userInfo.avatarUrl = avatarUrl.value\r\n        userInfo.userId = res.userID\r\n        uni.setStorageSync('token', res.userID)\r\n        uni.setStorageSync('userInfo', JSON.stringify(userInfo))\r\n        uni.hideLoading()\r\n        uni.showToast({\r\n            title: '注册成功',\r\n            icon: 'success'\r\n        })\r\n        setTimeout(() => {\r\n            uni.navigateBack()\r\n        }, 1000)\r\n    } catch (e) {\r\n        uni.__f__('log','at pages/register/register.vue:140',e)\r\n        uni.hideLoading()\r\n        uni.showToast({\r\n            title: '注册失败，请稍后重试',\r\n            icon: 'none'\r\n        })\r\n    }\r\n}\r\n\r\nconst changeAvatar = () => {\r\n    uni.chooseImage({\r\n        count: 1,\r\n        sizeType: ['compressed'],  // 压缩后的图片 或 original:原图\r\n        sourceType: ['album', 'camera'],  // 可以来自相册 相机\r\n        success: async (res) => {\r\n            avatarUrl.value = res.tempFilePaths\r\n        }\r\n    })\r\n}\r\n\r\n// 跳转到登录页\r\nconst goToLogin = () => {\r\n    uni.navigateBack()\r\n}\r\n\r\nonShow(() => {\r\n    avatarUrl.value = '/static/public/defaultAvatar.png'\r\n})\r\n\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.register-container {\r\n    background-color: #ffffff;\r\n    min-height: 100vh;\r\n\r\n    .register-header {\r\n        display: flex;\r\n        align-items: center;\r\n        padding: 20rpx;\r\n        position: relative;\r\n\r\n        .back-icon {\r\n            width: 40rpx;\r\n            height: 40rpx;\r\n        }\r\n\r\n        .header-title {\r\n            flex: 1;\r\n            text-align: center;\r\n            font-size: 36rpx;\r\n            font-weight: bold;\r\n            color: #333;\r\n        }\r\n    }\r\n\r\n    .register-form {\r\n        padding: 30rpx;\r\n\r\n        .avatar-container {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            margin: 30rpx 0 50rpx;\r\n            position: relative;\r\n\r\n            .avatar {\r\n                width: 180rpx;\r\n                height: 180rpx;\r\n                border-radius: 50%;\r\n                border: 8rpx solid #4bb0ff;\r\n            }\r\n\r\n            .avatar-upload {\r\n                margin-top: 15rpx;\r\n                font-size: 24rpx;\r\n                color: #4bb0ff;\r\n            }\r\n        }\r\n\r\n        .input-group {\r\n            margin-bottom: 40rpx;\r\n\r\n            .input-item {\r\n                margin-bottom: 30rpx;\r\n\r\n                .input-label {\r\n                    font-size: 28rpx;\r\n                    color: #666;\r\n                    margin-bottom: 15rpx;\r\n                    display: block;\r\n                }\r\n\r\n                .input-field {\r\n                    width: 92%;\r\n                    height: 80rpx;\r\n                    background-color: #f5f5f5;\r\n                    border-radius: 40rpx;\r\n                    padding: 0 30rpx;\r\n                    font-size: 28rpx;\r\n                }\r\n\r\n                .error-text {\r\n                    color: #EC6EAD;\r\n                    font-size: 24rpx;\r\n                    margin: 12rpx 0 0 20rpx;\r\n                    background-color: rgba(236, 110, 173, 0.1);\r\n                    padding: 8rpx 16rpx;\r\n                    border-radius: 10rpx;\r\n                    display: block;\r\n                    width: fit-content;\r\n                    max-width: 90%;\r\n                    word-break: break-all;\r\n                }\r\n            }\r\n        }\r\n\r\n        .register-options {\r\n            display: flex;\r\n            justify-content: flex-end;\r\n            margin-bottom: 40rpx;\r\n\r\n            .login-link {\r\n                font-size: 26rpx;\r\n                color: #4bb0ff;\r\n            }\r\n        }\r\n\r\n        .register-button {\r\n            width: 100%;\r\n            height: 90rpx;\r\n            background: linear-gradient(to right, #3494E6, #EC6EAD);\r\n            color: #fff;\r\n            font-size: 32rpx;\r\n            font-weight: bold;\r\n            border-radius: 45rpx;\r\n            margin-bottom: 50rpx;\r\n            line-height: 90rpx;\r\n        }\r\n\r\n        .wechat-register {\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n\r\n            .wechat-register-text {\r\n                font-size: 28rpx;\r\n                color: #999;\r\n                margin-bottom: 30rpx;\r\n            }\r\n\r\n            .wechat-register-button {\r\n                width: 60%;\r\n                height: 90rpx;\r\n                background-color: #07c160;\r\n                color: #fff;\r\n                font-size: 32rpx;\r\n                font-weight: bold;\r\n                border-radius: 45rpx;\r\n                line-height: 90rpx;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>","import MiniProgramPage from 'D:/uniappProject/旅游日记uniapp/pages/register/register.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","validateUsername","validatePassword","uni","uploadFiles","signUp","onShow"],"mappings":"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"}