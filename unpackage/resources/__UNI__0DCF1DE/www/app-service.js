if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a=t=>(a,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,o)},o=a("onShow"),l=a("onLoad"),n=a("onPageScroll"),s=a("onReachBottom"),i="/static/public/search.png",c="/static/666.jpg";let r="";function m(e,a={},o="GET"){return new Promise(((l,n)=>{uni.request({url:"https://ovmmqfovxbil.sealosbja.site"+e,data:a,method:o,header:{token:uni.getStorageSync("token")||""},success:e=>{200===e.statusCode||201===e.statusCode?!0===e.data.success?l(e.data.data||e.data):(uni.showToast({title:e.data.message,icon:"none"}),n(e.data.message)):(uni.showToast({title:e.data.message||"请求失败",icon:"none"}),n(e.data.message))},fail:e=>{t("log","at api/http.js:60",e),uni.showToast({title:"服务请求异常",icon:"none"}),n(e)}})}))}r="https://ovmmqfovxbil.sealosbja.site";let u="";u="https://ovmmqfovxbil.sealosbja.site";const d=e=>m(`/api/user/${e}`),p=e=>m(`/api/user/${e}/releases`),v=e=>m(`/api/user/${e}/liked`),g=(e,t)=>m(`/api/user/${e}/liked/${t}`,{},"DELETE"),w=(e=50,t=0)=>m("/api/releases",{limit:e,offset:t}),N=e=>m(`/api/release/${e}`),k=e=>m(`/api/user/${e}/following`),V=(e,t)=>m(`/api/user/${e}/follow`,t,"POST"),f=(e,t)=>m(`/api/user/${e}/follow/${t}`,{},"DELETE"),E=(e,t)=>new Promise(((a,o)=>{uni.uploadFile({url:t,filePath:e,name:"file",success:e=>{if(200===e.statusCode){const t=JSON.parse(e.data);a(t.success?t.data:null)}else o(`服务器错误(${e.statusCode})`)},fail:e=>o(e)})})),y=async(e,a="")=>{const o=Array.isArray(e)?e:[e];if(0===o.length||!o[0])return{pictures:[],videos:[],covers:[]};let l="https://ovmmqfovxbil.sealosbja.site/api/upload";a&&(l+=`?type=${a}`);try{uni.showLoading({title:"上传中..."});const e={pictures:[],videos:[],covers:[]};for(const t of o){const a=await E(t,l);a&&(a.pictures&&e.pictures.push(a.pictures),a.videos&&e.videos.push(a.videos),a.covers&&e.covers.push(a.covers))}return e}catch(n){return t("log","at api/api.js:159",n),{pictures:[],videos:[],covers:[]}}finally{uni.hideLoading()}};function h(e){if(!e)return"";return e.replace(/('|"|;|--|\/\*|\*\/|@@|@|char|nchar|varchar|nvarchar|alter|begin|cast|create|cursor|declare|delete|drop|end|exec|execute|fetch|insert|kill|open|select|sys|sysobjects|syscolumns|table|update)/gi,"").replace(/[<>]/g,"").trim()}function x(e){if(!e||!e.trim())return{isValid:!1,message:"用户名不能为空",filteredText:""};const t=h(e);if(t.length<3)return{isValid:!1,message:"用户名不能少于3个字符",filteredText:t};if(t.length>20)return{isValid:!1,message:"用户名不能超过20个字符",filteredText:t};if(!/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/.test(t))return{isValid:!1,message:"用户名只能包含字母、数字、下划线和中文",filteredText:t};return/(赌博|色情|暴力|政治|违法)/gi.test(t)?{isValid:!1,message:"用户名包含敏感词汇",filteredText:t}:{isValid:!0,message:"",filteredText:t}}function B(e){if(!e)return{isValid:!1,message:"密码不能为空",filteredText:""};if(e.length<6)return{isValid:!1,message:"密码不能少于6个字符",filteredText:e};if(e.length>20)return{isValid:!1,message:"密码不能超过20个字符",filteredText:e};return/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{6,}$/.test(e)?{isValid:!0,message:"",filteredText:e}:{isValid:!1,message:"密码必须包含至少一个字母和一个数字",filteredText:e}}function T(e,t=15){if(!e||!e.trim())return{isValid:!1,message:"标题不能为空",filteredText:""};const a=h(e);if(a.length>t)return{isValid:!1,message:`标题不能超过${t}个字符`,filteredText:a};return/(赌博|色情|暴力|政治|违法)/gi.test(a)?{isValid:!1,message:"标题包含敏感词汇",filteredText:a}:{isValid:!0,message:"",filteredText:a}}function b(e,t=10){if(!e||!e.trim())return{isValid:!1,message:"内容描述不能为空",filteredText:""};const a=h(e);if(a.length<t)return{isValid:!1,message:`内容描述不能少于${t}个字符`,filteredText:a};return/(赌博|色情|暴力|政治|违法)/gi.test(a)?{isValid:!1,message:"内容包含敏感词汇",filteredText:a}:{isValid:!0,message:"",filteredText:a}}function C(e){if(!e||!e.trim())return{isValid:!1,message:"位置不能为空",filteredText:""};const t=h(e);return t.length>25?{isValid:!1,message:"位置信息过长",filteredText:t}:{isValid:!0,message:"",filteredText:t}}const I=(e,t)=>{const a=e.__vccOpts||e;for(const[o,l]of t)a[o]=l;return a},S=I(e.defineComponent({__name:"index",setup(a){let l=e.ref(""),r=e.ref(!1),u=e.ref(!1),d=e.ref(!1),p=e.ref(1),v=e.ref(0),g=e.ref(!0),N=e.ref("");const k=e.ref([[],[]]),V=e.ref([[],[]]),f=e.ref([[],[]]),E=(e,t)=>{const a=e.length;if(0===a)return t[0]=[],void(t[1]=[]);if(a<14||a>14){const o=Math.ceil(a/2);t[0]=e.slice(0,o),t[1]=e.slice(o)}else t[0]=e.slice(0,7),t[1]=e.slice(7,14)};e.watchEffect((async()=>{if(!l.value){try{const e=await w(14,0);E(e.releases||[],k.value)}catch(e){t("log","at pages/index/index.vue:84",e)}d.value=!1,g.value=!0}}));const y=async()=>{N.value="";const e=function(e){if(!e||!e.trim())return{isValid:!1,message:"搜索内容不能为空",filteredText:""};const t=h(e);return t.length>10?{isValid:!1,message:"搜索内容不能超过10个字符",filteredText:t.substring(0,10)}:/(赌博|色情|暴力|政治|违法)/gi.test(t)?{isValid:!1,message:"搜索内容包含敏感词汇",filteredText:t}:{isValid:!0,message:"",filteredText:t}}(l.value);if(e.isValid){l.value=e.filteredText;try{const e=await(a={userName:l.value,title:l.value},m("/api/releases/search",a,"POST"));d.value=!0,g.value=!1,E(e.byUserName||[],V.value),E(e.byTitle||[],f.value),e.byUserName.length>0?(k.value=V.value,u.value=!1):e.byTitle.length>0?(k.value=f.value,u.value=!0):N.value="未找到相关内容"}catch(o){t("log","at pages/index/index.vue:115",o),N.value="搜索失败，请稍后再试"}var a}else N.value=e.message},x=()=>{uni.pageScrollTo({scrollTop:0,duration:300})},B=async e=>{if(1===e&&1!==p.value){v.value-=14;try{const e=await w(14,v.value);E(e.releases||[],k.value),x(),p.value--}catch(a){t("log","at pages/index/index.vue:142",a),uni.showToast({title:"获取数据失败",icon:"none"})}}else if(2===e){v.value+=14;try{const e=await w(14,v.value);E(e.releases||[],k.value),x(),p.value++}catch(a){t("log","at pages/index/index.vue:157",a),uni.showToast({title:"获取数据失败",icon:"none"})}}};return o((async()=>{try{const e=await w(14,0);E(e.releases||[],k.value)}catch(e){t("log","at pages/index/index.vue:171",e)}l.value=""})),s((()=>{})),n((e=>{e.scrollTop>300?r.value=!0:r.value=!1})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"home-container"},[e.createElementVNode("view",{class:"home-content"},[e.createElementVNode("view",{class:"home-input"},[e.createElementVNode("image",{src:i,class:"home-search-icon"}),e.withDirectives(e.createElementVNode("input",{class:"home-input-search",placeholder:"搜一搜","onUpdate:modelValue":a[0]||(a[0]=t=>e.isRef(l)?l.value=t:l=t)},null,512),[[e.vModelText,e.unref(l)]]),e.createElementVNode("view",{class:"home-input-go",onClick:y},"搜索")]),e.unref(N)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"search-error"},e.toDisplayString(e.unref(N)),1)):e.createCommentVNode("",!0)]),e.unref(d)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"home-choose"},[V.value[0][0]?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["home-user",{active:!e.unref(u)}]),onClick:a[1]||(a[1]=t=>(e.isRef(u)?u.value=!1:u=!1,k.value=V.value))}," 用户",2)):e.createCommentVNode("",!0),f.value[0][0]?(e.openBlock(),e.createElementBlock("view",{key:1,class:e.normalizeClass(["home-release",{active:e.unref(u)}]),onClick:a[2]||(a[2]=t=>(e.isRef(u)?u.value=!0:u=!0,k.value=f.value))}," 游记",2)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"home-waterfall"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(2,((t,a)=>e.createElementVNode("view",{class:"home-waterfall-box",key:a},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.value[t-1],(t=>(e.openBlock(),e.createElementBlock("view",{class:"home-waterfall-content",key:t.name,onClick:e=>{return a=t,void uni.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(a))}`});var a}},[e.createElementVNode("image",{class:"waterfall-img",src:t.pictures[0],mode:"widthFix","lazy-load":"true"},null,8,["src"]),e.createElementVNode("view",{class:"waterfall-title"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"person-info"},[e.createElementVNode("image",{class:"waterfall-avatar",src:c,mode:"aspectFill"}),e.createElementVNode("view",{class:"waterfall-name"},e.toDisplayString(t.userName),1)])],8,["onClick"])))),128))]))),64))]),e.unref(g)?(e.openBlock(),e.createElementBlock("view",{key:1,class:"home-page"},[e.createElementVNode("view",{class:"home-page-change",onClick:a[3]||(a[3]=e=>B(1))},"上一页"),e.createElementVNode("view",{class:"home-page-curPage"},"第"+e.toDisplayString(e.unref(p))+"页",1),e.createElementVNode("view",{class:"home-page-change",onClick:a[4]||(a[4]=e=>B(2))},"下一页")])):e.createCommentVNode("",!0),e.unref(r)?(e.openBlock(),e.createElementBlock("image",{key:2,class:"home-gotop",onClick:x,src:"/static/public/goTop.png"})):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-2acb5274"]]),D="/static/public/followed.png",_="/static/public/location.png",F="/static/public/money.png",U="/static/public/person.png",P="/static/public/time.png",L="/static/public/close.png";let M=null,A=!1,O=null,$=null;const R=(e,a)=>{O=a,new Promise(((e,a)=>{if(M)e(M);else if(A){const t=setInterval((()=>{M&&(clearInterval(t),e(M))}),100);setTimeout((()=>{M||(clearInterval(t),A=!1,a(new Error("连接超时")))}),5e3)}else{A=!0;try{M=uni.connectSocket({url:"wss://ovmmqfovxbil.sealosbja.site",success:()=>{},fail:e=>{t("log","at api/ws.js:43","WebSocket连接失败:",e),A=!1,a(e)}}),$=setTimeout((()=>{M||(A=!1,a(new Error("连接超时")))}),5e3),M.onOpen((()=>{$&&clearTimeout($),A=!1,e(M)})),M.onMessage((e=>{try{const t=JSON.parse(e.data);if(O)switch(t.type){case"chat":O({type:"update",content:t.content,onlineInfo:t.onlineInfo});break;case"done":O({type:"complete",content:t.content,totalTokens:t.totalTokens});break;case"error":O({type:"error",error:t.error});break;case"end":O({type:"end"})}}catch(a){t("log","at api/ws.js:99","解析WebSocket消息失败:",a)}})),M.onError((e=>{t("log","at api/ws.js:104","socketTask发生错误:",e),$&&clearTimeout($),M=null,A=!1,a(e)})),M.onClose((()=>{t("log","at api/ws.js:114","WebSocket连接已关闭"),$&&clearTimeout($),M=null,A=!1}))}catch(o){t("log","at api/ws.js:122","创建WebSocket连接时发生错误:",o),A=!1,a(o)}}})).then((t=>{t.send({data:JSON.stringify({type:"chat",message:e}),success:()=>{},fail:e=>{a&&a({type:"error",error:"发送消息失败"+e.message})}})})).catch((e=>{a&&a({type:"error",error:"WebSocket连接失败: "+e.message})}))},j=I(e.defineComponent({__name:"detail",setup(a,{expose:n}){const s=e.ref(!1),i=e.ref(!1),r=e.ref(!1),u=e.ref(""),p=e.ref(""),v=e.ref([]),w=e.ref({avatar:"",content:"",createdAt:"0000-00-00",id:0,location:"",money:"",personNum:0,pictures:["/static/555.jpg"],playTime:0,releaseID:"release0",title:"",updatedAt:"0000-00-00",userID:"",userName:"testuser0",videos:[]}),N=e.ref([{id:1,title:"附近景点",image:"/static/public/build.png",selectedImage:"/static/public/build-white.png"},{id:2,title:"附近美食",image:"/static/public/food.png",selectedImage:"/static/public/food-white.png"},{id:3,title:"经济旅游",image:"/static/public/sale.png",selectedImage:"/static/public/sale-white.png"},{id:4,title:"自驾旅游",image:"/static/public/jeepCar.png",selectedImage:"/static/public/jeepCar-white.png"},{id:5,title:"特色住宿",image:"/static/public/hotal.png",selectedImage:"/static/public/hotal-white.png"},{id:6,title:"购物攻略",image:"/static/public/shopping.png",selectedImage:"/static/public/shopping-white.png"}]),k=()=>{const e=N.value.filter((e=>v.value.includes(e.id)));let a="";e.forEach((e=>{a+=e.title+","}));const o=`我想去${u.value}游玩,并为我提供${a}的建议,分点明确(一级标题:一,二 二级标题:1,2),不要出现*#等特殊符号`;R(o,(e=>{"update"===e.type?p.value+=e.content:"error"===e.type&&t("log","at pages/detail/detail.vue:194",e.error)}))},E=()=>{uni.setClipboardData({data:p.value,success:()=>{uni.showToast({title:"复制成功",icon:"none"})}})},y=()=>{p.value=""},h=async()=>{try{const t=JSON.parse(uni.getStorageSync("userInfo")).userId;s.value?(await g(t,w.value.releaseID),uni.showToast({title:"取消收藏",icon:"none"})):(await(e=t,a=w.value.releaseID,m(`/api/user/${e}/liked`,{releaseID:a},"POST")),uni.showToast({title:"收藏成功",icon:"none"}));const o=await d(t);s.value=JSON.parse(o.liked).includes(w.value.releaseID)}catch(o){t("log","at pages/detail/detail.vue:234",o),uni.showToast({title:"操作失败",icon:"none"})}var e,a},x=()=>{uni.navigateTo({url:`/pages/follow/works?userID=${w.value.userID}`})};n({onShareAppMessage:()=>({title:"旅游日记分享",path:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(w.value))}`,imageUrl:w.value.pictures[0]||"/static/public/555.jpg"}),onShareTimeline:()=>({title:"旅游日记分享",query:`info=${encodeURIComponent(JSON.stringify(w.value))}`,imageUrl:w.value.pictures[0]||"/static/public/555.jpg"})});const B=()=>{const e=JSON.parse(uni.getStorageSync("userInfo")).userId;i.value?uni.showModal({title:"取关提示",content:`确定要取消关注"${w.value.userName}"吗？`,success:async a=>{if(a.confirm)try{await f(e,w.value.userID),uni.showToast({title:"已取消关注",icon:"none"});const t=await d(e);i.value=t.follow.includes(w.value.userID)}catch(o){t("log","at pages/detail/detail.vue:312",o),uni.showToast({title:"操作失败",icon:"none"})}}}):uni.showModal({title:"关注提示",content:`确定要关注"${w.value.userName}"吗？`,success:async a=>{if(a.confirm)try{await V(e,{followUserID:w.value.userID}),uni.showToast({title:"关注成功",icon:"none"});const t=await d(e);i.value=t.follow.includes(w.value.userID)}catch(o){t("log","at pages/detail/detail.vue:288",o),uni.showToast({title:o,icon:"none"})}}})},T=(e,a)=>{const o=e.map((e=>String(e)));uni.previewImage({urls:o,current:o[a],fail:e=>{t("error","at pages/detail/detail.vue:331","预览失败:",e)}})},b=e=>{const t=e.detail.fullScreen||e.detail.fullscreen,a=e.detail.direction;t?uni.showToast({title:`已进入${"vertical"===a?"竖向":"横向"}全屏模式`,icon:"none",duration:1500}):uni.showToast({title:"已退出全屏模式",icon:"none",duration:1500})},C=e=>{t("error","at pages/detail/detail.vue:357","视频播放错误:",e.detail),uni.showToast({title:"视频播放失败",icon:"none"})};return l((async e=>{try{if(e.info){const t=JSON.parse(decodeURIComponent(e.info));w.value=t}if(u.value=w.value.location,w.value.userID){const e=JSON.parse(uni.getStorageSync("userInfo")).userId;d(e).then((e=>{s.value=JSON.parse(e.liked).includes(w.value.releaseID),i.value=e.follow.includes(w.value.userID)}))}}catch(a){t("log","at pages/detail/detail.vue:380",a)}})),o((()=>{try{if(w.value.userID){const e=JSON.parse(uni.getStorageSync("userInfo")).userId;d(e).then((e=>{s.value=JSON.parse(e.liked).includes(w.value.releaseID),i.value=e.follow.includes(w.value.userID)}))}}catch(e){t("log","at pages/detail/detail.vue:395",e)}})),(t,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"detail-container"},[w.value.pictures.length>0&&0===w.value.videos.length?(e.openBlock(),e.createElementBlock("swiper",{key:0,class:"detail-swiper","indicator-dots":"","indicator-active-color":"#3494E6","indicator-color":"rgba(255,255,255,0.5)",interval:3e3,duration:500,circular:""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value.pictures,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:"pic-"+a},[e.createElementVNode("image",{class:"swiper-image",src:t,onClick:e=>T(w.value.pictures,a),mode:"aspectFill"},null,8,["src","onClick"])])))),128))],8,["indicator-color"])):(e.openBlock(),e.createElementBlock("swiper",{key:1,class:"detail-swiper","indicator-dots":"","indicator-active-color":"#3494E6","indicator-color":"rgba(255,255,255,0.5)",interval:3e3,duration:500,circular:""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value.videos,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:"vid-"+a},[e.createElementVNode("video",{class:"swiper-video",src:t,poster:w.value.cover,controls:"",direction:"",id:"video-"+a,"show-fullscreen-btn":"","show-center-play-btn":"",onFullscreenchange:b,onError:C},null,40,["src","poster","id"])])))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.value.pictures,((t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:"pic-"+a},[e.createElementVNode("image",{class:"swiper-image",src:t,onClick:e=>T(w.value.pictures,a),mode:"aspectFill"},null,8,["src","onClick"])])))),128))],8,["indicator-color"])),e.createElementVNode("view",{class:"detail-top"},[e.createElementVNode("view",{class:"detail-title"},[e.createElementVNode("text",{class:"animated-text"},e.toDisplayString(w.value.title),1),e.createElementVNode("view",{class:"action-buttons"},[e.createElementVNode("view",{class:"detail-liked",onClick:h},[e.createElementVNode("text",{class:"like-text"},"收藏"),e.createElementVNode("text",{class:"like-icon",style:e.normalizeStyle({color:s.value?"red":"white"})},"♥",4)])])])]),e.createElementVNode("view",{class:"publisher-container"},[e.createElementVNode("view",{class:"publisher-info"},[e.createElementVNode("image",{class:"user-avatar",src:c,mode:"aspectFill",onClick:x}),e.createElementVNode("view",{class:"user-details"},[e.createElementVNode("text",{class:"user-name",onClick:x},e.toDisplayString(w.value.userName),1),e.createElementVNode("text",{class:"publish-time",onClick:x},"发布于 "+e.toDisplayString(w.value.createdAt.slice(0,10)),1)]),i.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"follow-btn",onClick:B},[e.createElementVNode("text",null,"已关注"),e.createElementVNode("image",{src:D,style:{width:"35rpx",height:"35rpx",padding:"13rpx 5rpx"}})])):(e.openBlock(),e.createElementBlock("view",{key:0,class:"follow-btn",onClick:B},[e.createElementVNode("text",null,"关注"),e.createElementVNode("image",{src:"/static/public/no-follow.png",style:{width:"35rpx",height:"35rpx",padding:"13rpx 5rpx"}})]))])]),e.createElementVNode("view",{class:"detail-content"},[e.createElementVNode("view",{class:"section-heading"},"旅行详情"),e.createElementVNode("view",{class:"detail-item content-box"},[e.createElementVNode("text",{class:"item-value0"},e.toDisplayString(w.value.content),1)]),e.createElementVNode("view",{class:"detail-item location-box"},[e.createElementVNode("text",{class:"item-label"},"旅游地点"),e.createElementVNode("view",{class:"location-wrapper"},[e.createElementVNode("view",{class:"location-wrapper-title"},[e.createElementVNode("image",{src:_,class:"mini-icon"}),e.createElementVNode("text",{class:"item-value1"},e.toDisplayString(w.value.location),1)]),e.createElementVNode("view",{class:"wantGo",onClick:a[0]||(a[0]=e=>r.value=!0)},[e.createTextVNode(" 想去 "),e.createElementVNode("image",{src:"/static/public/wantGo.png"})])])]),e.createElementVNode("view",{class:"detail-info"},[e.createElementVNode("view",{class:"info-item price-item"},[e.createElementVNode("image",{src:F,class:"info-icon"}),e.createElementVNode("text",null,e.toDisplayString(w.value.money)+"元",1)]),e.createElementVNode("view",{class:"info-item person-item"},[e.createElementVNode("image",{src:U,class:"info-icon"}),e.createElementVNode("text",null,e.toDisplayString(w.value.personNum)+"人",1)]),e.createElementVNode("view",{class:"info-item time-item"},[e.createElementVNode("image",{src:P,class:"info-icon"}),e.createElementVNode("text",null,e.toDisplayString(w.value.playTime)+"天",1)])])])]),r.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"detail-float"},[e.createElementVNode("view",{class:"detail-float-item"},[e.createElementVNode("view",{class:"detail-float-item-option",style:{"font-weight":"600","font-size":"30rpx"}},[e.createTextVNode(" 旅游规划 "),p.value.length>0?(e.openBlock(),e.createElementBlock("image",{key:0,src:"/static/public/copy.png",onClick:E})):e.createCommentVNode("",!0),p.value.length>0?(e.openBlock(),e.createElementBlock("image",{key:1,src:"/static/public/delete.png",onClick:y})):e.createCommentVNode("",!0)]),e.createElementVNode("image",{src:L,onClick:a[1]||(a[1]=e=>r.value=!1)})]),0===p.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"detail-float-choose"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.value,(t=>(e.openBlock(),e.createElementBlock("view",{class:"detail-float-choose-item",key:t.id,style:e.normalizeStyle({background:v.value.find((e=>e===t.id))?"#FFA07A":"#b6b6b635",color:v.value.find((e=>e===t.id))?"white":"#999"}),onClick:e=>(e=>{let t=v.value.indexOf(e);-1!==t?v.value.splice(t,1):v.value.push(e)})(t.id)},[e.createElementVNode("image",{src:v.value.find((e=>e===t.id))?t.selectedImage:t.image},null,8,["src"]),e.createTextVNode(" "+e.toDisplayString(t.title),1)],12,["onClick"])))),128))])):e.createCommentVNode("",!0),0===p.value.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"detail-float-input"},[e.createTextVNode(" 我也想去 "),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e)},null,512),[[e.vModelText,u.value]]),e.createElementVNode("view",{class:"detail-float-input-go",onClick:k},"GO")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"detail-float-res"},[e.createElementVNode("view",{class:"detail-float-res-content"},e.toDisplayString(p.value),1)]))])):e.createCommentVNode("",!0)],64))}}),[["__scopeId","data-v-c82ebc1e"]]),J="/static/public/back.png",q=I(e.defineComponent({__name:"My",setup(a){let n=e.ref(!1);const s=e.ref(!1),i=e.reactive({nickName:"",avatarUrl:"",userId:""}),c=()=>{if(uni.getStorageSync("token")){s.value=!0;const e=uni.getStorageSync("userInfo");e&&Object.assign(i,JSON.parse(e))}},r=()=>{uni.navigateTo({url:"/pages/login/login"})},u=()=>{uni.navigateTo({url:"/pages/register/register"})},d=()=>{uni.showModal({title:"提示",content:"确定要退出登录吗？",success:e=>{e.confirm&&(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),s.value=!1,Object.assign(i,{nickName:"",avatarUrl:"",userId:""}),uni.showToast({title:"已退出登录",icon:"success"}))}})},p=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{try{const t=await y(e.tempFilePaths,"image");i.avatarUrl=t.pictures[0]}catch(a){t("log","at pages/My/My.vue:162",a)}}})},v=async()=>{try{await(e=i.userId,a={userID:i.userId,userName:i.nickName,avatar:i.avatarUrl},m(`/api/user/${e}`,a,"PUT")),uni.setStorageSync("userInfo",JSON.stringify(i)),n.value=!1,uni.showToast({title:"修改成功",icon:"success"})}catch(o){t("log","at pages/My/My.vue:182",o),uni.showToast({title:"修改失败",icon:"none"})}var e,a},g=e=>{s.value?"follow"!==e?uni.navigateTo({url:`/pages/${e}/${e}`}):uni.navigateTo({url:`/pages/${e}/list`}):uni.showModal({title:"提示",content:"请先登录",success:e=>{e.confirm&&r()}})};return l((()=>{c()})),o((()=>{c()})),(t,a)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"my-container"},[e.createElementVNode("view",{class:e.normalizeClass(["user-info-section",{"logged-in":s.value}])},[s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"user-profile"},[e.createElementVNode("image",{class:"user-avatar",src:i.avatarUrl,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-name"},[e.createTextVNode(e.toDisplayString(i.nickName||"用户")+" ",1),e.createElementVNode("image",{class:"changeInfoIcon",src:"/static/public/change.png",onClick:a[0]||(a[0]=t=>e.isRef(n)?n.value=!0:n=!0)})])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"login-section"},[e.createElementVNode("image",{class:"default-avatar",src:"/static/public/defaultAvatar.png",mode:"aspectFill"}),e.createElementVNode("view",{class:"login-btns"},[e.createElementVNode("button",{class:"login-btn",onClick:r},"登录"),e.createElementVNode("button",{class:"register-btn",onClick:u},"注册")])]))],2),e.createElementVNode("view",{class:"options-section"},[e.createElementVNode("view",{class:"option-group"},[e.createElementVNode("view",{class:"option-item",onClick:a[1]||(a[1]=e=>g("collection"))},[e.createElementVNode("image",{class:"option-icon",src:"/static/public/like.png"}),e.createElementVNode("text",{class:"option-text"},"我的收藏"),e.createElementVNode("image",{class:"arrow-icon",src:J})]),e.createElementVNode("view",{class:"option-item",onClick:a[2]||(a[2]=e=>g("notes"))},[e.createElementVNode("image",{class:"option-icon",style:{transform:"translateX(-4rpx)",width:"50rpx",height:"55rpx"},src:"/static/public/note.png"}),e.createElementVNode("text",{class:"option-text"},"我的笔记"),e.createElementVNode("image",{class:"arrow-icon",src:J})]),e.createElementVNode("view",{class:"option-item",onClick:a[3]||(a[3]=e=>g("follow"))},[e.createElementVNode("image",{class:"option-icon",style:{width:"40rpx",height:"40rpx"},src:D}),e.createElementVNode("text",{class:"option-text"},"我的关注"),e.createElementVNode("image",{class:"arrow-icon",src:J})])]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"logout-btn",onClick:d}," 退出登录 ")):e.createCommentVNode("",!0)])]),e.unref(n)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"changeInfo"},[e.createElementVNode("view",{class:"changeInfo-top"},[e.createElementVNode("view",{class:"changeInfo-top-title"},"修改您的头像、昵称"),e.createElementVNode("image",{class:"changeInfo-top-close",src:L,onClick:a[4]||(a[4]=t=>e.isRef(n)?n.value=!1:n=!1)})]),e.createElementVNode("view",{class:"changeInfo-avatar"},[e.createTextVNode(" 头像: "),e.createElementVNode("button",{class:"changeInfo-avatar-title",onClick:p},[e.createElementVNode("image",{class:"changeInfo-avatar-title-image",src:i.avatarUrl,mode:"aspectFill"},null,8,["src"])])]),e.createElementVNode("view",{class:"changeInfo-nickname"},[e.createElementVNode("view",{class:"changeInfo-nickname-title"},"昵称:"),e.withDirectives(e.createElementVNode("input",{class:"changeInfo-nickname-input","onUpdate:modelValue":a[5]||(a[5]=e=>i.nickName=e),placeholder:i.nickName},null,8,["placeholder"]),[[e.vModelText,i.nickName]])]),e.createElementVNode("button",{class:"changeInfo-ensure",onClick:v},"确定")])):e.createCommentVNode("",!0)],64))}}),[["__scopeId","data-v-10a9f65e"]]),z=I(e.defineComponent({__name:"Release",setup(a){const l=e.reactive({userID:"",title:"",playTime:"",money:"",personNum:"",content:"",location:"",pictures:[],videos:[],cover:""}),n=e.reactive({title:"",playTime:"",money:"",personNum:"",content:"",location:"",pictures:""}),s=async()=>{if((()=>{let e=!0;for(let l in n)n[l]="";const t=T(l.title);t.isValid?l.title=t.filteredText:(n.title=t.message,e=!1),l.playTime?(isNaN(Number(l.playTime))||Number(l.playTime)<=0)&&(n.playTime="请输入有效的游玩时间",e=!1):(n.playTime="游玩时间不能为空",e=!1),l.money?(isNaN(Number(l.money))||Number(l.money)<0)&&(n.money="请输入有效的费用金额",e=!1):(n.money="费用不能为空",e=!1),l.personNum?(isNaN(Number(l.personNum))||Number(l.personNum)<=0||!Number.isInteger(Number(l.personNum)))&&(n.personNum="请输入有效的人数",e=!1):(n.personNum="人数不能为空",e=!1);const a=C(l.location);a.isValid?l.location=a.filteredText:(n.location=a.message,e=!1);const o=b(l.content);return o.isValid?l.content=o.filteredText:(n.content=o.message,e=!1),l.pictures&&0!==l.pictures.length||(n.pictures="至少上传一张图片",e=!1),e})()){uni.showLoading({title:"正在处理..."});try{if(l.pictures.length>0){const e=await y(l.pictures,"image");l.pictures=e.pictures}if(l.videos.length>0){const e=await y(l.videos,"video");l.videos=e.videos}if(l.cover){const e=await y(l.cover,"cover");l.cover=e.covers[0]}const t={...l,playTime:Number(l.playTime),money:Number(l.money),personNum:Number(l.personNum)};await(e=t,m("/api/release",e,"POST")),uni.hideLoading(),uni.showToast({title:"发布成功",icon:"success"}),i(),uni.navigateTo({url:"/pages/notes/notes"})}catch(a){t("log","at pages/Release/Release.vue:242","发布过程失败:",a),uni.hideLoading(),uni.showToast({title:"发布失败，请重试",icon:"none"})}var e}else uni.showToast({title:"请完善表单信息",icon:"none"})},i=()=>{const e=l.userID;Object.assign(l,{userID:e,title:"",playTime:"",money:"",personNum:"",content:"",location:"",pictures:[],videos:[],cover:""});for(let t in n)n[t]=""},c=e=>{"image"===e?uni.chooseImage({count:5-l.pictures.length,success:e=>{uni.showLoading({title:"处理图片中..."});let t=0;const a=e.tempFilePaths.length;e.tempFilePaths.forEach((e=>{uni.compressImage({src:e,quality:80,success:e=>{l.pictures.push(e.tempFilePath),t++,t>=a&&uni.hideLoading()},fail:()=>{l.pictures.push(e),uni.showToast({title:"部分图片压缩失败",icon:"none",duration:1e3}),t++,t>=a&&uni.hideLoading()}})}))}}):"video"===e?uni.chooseVideo({count:1,compressed:!0,success:e=>{uni.showLoading({title:"处理视频中..."}),uni.getVideoInfo({src:e.tempFilePath,success:t=>{uni.hideLoading(),t.duration>60?uni.showToast({title:"视频时长不能超过1分钟",icon:"none"}):l.videos=[e.tempFilePath]},fail:()=>{uni.hideLoading(),l.videos=[e.tempFilePath]}})}}):"cover"===e&&uni.chooseImage({count:1,success:e=>{uni.showLoading({title:"处理封面中..."}),uni.compressImage({src:e.tempFilePaths[0],quality:80,success:e=>{uni.hideLoading(),l.cover=e.tempFilePath},fail:()=>{uni.hideLoading(),l.cover=e.tempFilePaths[0],uni.showToast({title:"封面压缩失败",icon:"none",duration:1e3})}})}})},r=(e,t)=>{"image"===e?l.pictures.splice(t,1):"video"===e?l.videos.splice(t,1):"cover"===e&&(l.cover="")},u=()=>{uni.getSetting({success:e=>{e.authSetting["scope.userLocation"]?d():uni.authorize({scope:"scope.userLocation",success:()=>{d()},fail:()=>{uni.showModal({title:"提示",content:"需要您授权位置信息才能选择位置",confirmText:"去设置",success:e=>{e.confirm&&uni.openSetting()}})}})},fail:e=>{t("log","at pages/Release/Release.vue:407","获取设置失败",e),p()}})},d=()=>{try{uni.chooseLocation({success:e=>{l.location=e.name},fail:e=>{t("log","at pages/Release/Release.vue:423","选择位置失败",e),e.errMsg&&e.errMsg.includes("requiredPrivateInfos")&&(uni.showToast({title:"位置服务未配置",icon:"none"}),p())}})}catch(e){t("error","at pages/Release/Release.vue:435","调用选择位置接口失败",e),p()}},p=()=>{uni.showModal({title:"手动输入位置",editable:!0,placeholderText:"请输入您的位置",success:e=>{if(e.confirm&&e.content){const t=C(e.content);t.isValid?l.location=t.filteredText:uni.showToast({title:t.message,icon:"none"})}}})},v=()=>{uni.navigateTo({url:"/pages/notes/notes"})};return o((()=>{try{const e=uni.getStorageSync("userInfo");e?l.userID=JSON.parse(e).userId:uni.navigateTo({url:"/pages/login/login"})}catch(e){t("error","at pages/Release/Release.vue:482","获取用户信息失败",e)}})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"release-container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"title"},"发布旅游日记"),e.createElementVNode("view",{class:"my-notes-btn",onClick:v},"我的笔记")]),e.createElementVNode("view",{class:"form-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label required"},[e.createTextVNode("标题 "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[0]||(a[0]=e=>l.title=e),placeholder:"请输入旅游日记标题"},null,512),[[e.vModelText,l.title]]),n.title?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.title),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-row"},[e.createElementVNode("view",{class:"form-item-half"},[e.createElementVNode("text",{class:"label required"},[e.createTextVNode("游玩时间 "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.withDirectives(e.createElementVNode("input",{class:"input-short",type:"number","onUpdate:modelValue":a[1]||(a[1]=e=>l.playTime=e),placeholder:"时间/天"},null,512),[[e.vModelText,l.playTime]]),n.playTime?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text",style:{"max-width":"140rpx"}},e.toDisplayString(n.playTime),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-item-half"},[e.createElementVNode("text",{class:"label required"},[e.createTextVNode("费用 "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.withDirectives(e.createElementVNode("input",{class:"input-short",type:"number","onUpdate:modelValue":a[2]||(a[2]=e=>l.money=e),placeholder:"花费金额"},null,512),[[e.vModelText,l.money]]),n.money?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text",style:{"max-width":"140rpx"}},e.toDisplayString(n.money),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-item-half"},[e.createElementVNode("text",{class:"label required"},[e.createTextVNode("人数 "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.withDirectives(e.createElementVNode("input",{class:"input-short",type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>l.personNum=e),placeholder:"出行人数"},null,512),[[e.vModelText,l.personNum]]),n.personNum?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text",style:{"max-width":"140rpx"}},e.toDisplayString(n.personNum),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"form-item location-item"},[e.createElementVNode("text",{class:"label required"},[e.createTextVNode("位置 "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.createElementVNode("view",{class:"location-picker",onClick:u},[e.createElementVNode("text",null,e.toDisplayString(l.location||"点击选择位置"),1)]),n.location?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.location),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label required"},[e.createTextVNode("内容描述 "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.withDirectives(e.createElementVNode("textarea",{class:"textarea","onUpdate:modelValue":a[4]||(a[4]=e=>l.content=e),placeholder:"请描述您的旅游体验..."},null,512),[[e.vModelText,l.content]]),n.content?(e.openBlock(),e.createElementBlock("text",{key:0,class:"error-text"},e.toDisplayString(n.content),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},[e.createTextVNode("图片上传 (最多5张) "),e.createElementVNode("text",{style:{color:"rgba(236, 110, 173, 1)"}},"*")]),e.createElementVNode("view",{class:"upload-area"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.pictures,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload-preview",key:"pic-"+a},[e.createElementVNode("image",{class:"preview-image",src:t,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"delete-icon",onClick:e=>r("image",a)},"×",8,["onClick"])])))),128)),l.pictures.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-btn",onClick:a[5]||(a[5]=e=>c("image"))},[e.createElementVNode("text",{class:"upload-icon"},"+")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"视频上传 (最多1个)"),e.createElementVNode("view",{class:"upload-area"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.videos,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"upload-preview",key:"vid-"+a},[e.createElementVNode("video",{class:"preview-video",src:t},null,8,["src"]),e.createElementVNode("text",{class:"delete-icon",onClick:e=>r("video",a)},"×",8,["onClick"])])))),128)),0===l.videos.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-btn",onClick:a[6]||(a[6]=e=>c("video"))},[e.createElementVNode("text",{class:"upload-icon"},"+")])):e.createCommentVNode("",!0)])]),l.videos.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"form-item"},[e.createElementVNode("text",{class:"label"},"视频封面"),e.createElementVNode("view",{class:"upload-area"},[l.cover?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-preview"},[e.createElementVNode("image",{class:"preview-image",src:l.cover,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"delete-icon",onClick:a[7]||(a[7]=e=>r("cover"))},"×")])):e.createCommentVNode("",!0),l.cover?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"upload-btn",onClick:a[8]||(a[8]=e=>c("cover"))},[e.createElementVNode("text",{class:"upload-icon"},"+")]))])])):e.createCommentVNode("",!0),e.createElementVNode("button",{class:"submit-btn",onClick:s},"发布日记")])]))}}),[["__scopeId","data-v-11c76abd"]]),G=I(e.defineComponent({__name:"login",setup(a){const o=e.ref(""),l=e.ref(""),n=e.reactive({username:"",password:""}),s=()=>{if(!(()=>{let e=!0;const t=(a=o.value).trim()?a.length<3?{isValid:!1,message:"用户名不能少于3个字符"}:a.length>20?{isValid:!1,message:"用户名不能超过20个字符"}:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/.test(a)?{isValid:!0,message:""}:{isValid:!1,message:"用户名只能包含字母、数字、下划线和中文"}:{isValid:!1,message:"用户名不能为空"};var a;t.isValid||(n.username=t.message,e=!1);const s=(i=l.value)?i.length<6?{isValid:!1,message:"密码不能少于6个字符"}:i.length>20?{isValid:!1,message:"密码不能超过20个字符"}:{isValid:!0,message:""}:{isValid:!1,message:"密码不能为空"};var i;return s.isValid||(n.password=s.message,e=!1),e})())return;uni.showLoading({title:"登录中..."});const e={nickName:o.value,avatarUrl:"/static/666.jpg",userId:"12345"};try{(a={userName:o.value,passWord:l.value},m("/api/checkLogin",a,"POST")).then((async t=>{await new Promise((e=>{uni.hideLoading(),uni.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{e()}),1e3)})),e.userId=t.userID,e.nickName=o.value,e.avatarUrl="/static/666.jpg",await uni.setStorageSync("token",t.userID),await uni.setStorageSync("userInfo",JSON.stringify(e)),uni.navigateBack()})).catch((e=>{t("log","at pages/login/login.vue:131",e),uni.hideLoading(),uni.showToast({title:"登录失败，请检查用户名和密码",icon:"none"})}))}catch(s){t("log","at pages/login/login.vue:139",s),uni.hideLoading(),uni.showToast({title:"登录失败，请稍后重试",icon:"none"})}var a},i=()=>{uni.navigateTo({url:"/pages/register/register"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("view",{class:"login-branding"},[e.createElementVNode("image",{class:"app-logo",src:"/static/public/logo.png",mode:"aspectFit"}),e.createElementVNode("view",{class:"brand-title"},"旅游日记"),e.createElementVNode("view",{class:"brand-slogan"},"记录旅途，分享精彩")]),e.createElementVNode("view",{class:"login-form"},[e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"用户名"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),placeholder:"请输入用户名",onInput:a[1]||(a[1]=e=>n.username="")},null,544),[[e.vModelText,o.value]]),n.username?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(n.username),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"密码"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"password","onUpdate:modelValue":a[2]||(a[2]=e=>l.value=e),placeholder:"请输入密码",onInput:a[3]||(a[3]=e=>n.password="")},null,544),[[e.vModelText,l.value]]),n.password?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(n.password),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"login-options"},[e.createElementVNode("text",{class:"register-link",onClick:i},"没有账号? 去注册")]),e.createElementVNode("button",{class:"login-button",onClick:s},"登录")])]))}}),[["__scopeId","data-v-3e933822"]]),W=I(e.defineComponent({__name:"register",setup(a){const l=e.ref(""),n=e.ref(""),s=e.ref(""),i=e.ref(""),c=e.ref("/static/public/defaultAvatar.png"),r=e.reactive({username:"",confirmUsername:"",password:"",confirmPassword:""}),u=async()=>{if(!(()=>{let e=!0;for(let l in r)r[l]="";const t=x(l.value);t.isValid?l.value=t.filteredText:(r.username=t.message,e=!1);const a=x(n.value);a.isValid?n.value=a.filteredText:(r.confirmUsername=a.message,e=!1);const o=B(s.value);o.isValid||(r.password=o.message,e=!1);const c=B(i.value);return c.isValid?s.value!==i.value&&(r.confirmPassword="两次输入的密码不一致",e=!1):(r.confirmPassword=c.message,e=!1),e})())return;uni.showLoading({title:"注册中..."});const e=await y(c.value,"image");c.value=e.pictures[0];const a={nickName:l.value,avatarUrl:"",userId:""};try{const e=await(o={userName:l.value,passWord:s.value,avatar:c.value},m("/api/signUp",o,"POST"));a.nickName=l.value,a.avatarUrl=c.value,a.userId=e.userID,uni.setStorageSync("token",e.userID),uni.setStorageSync("userInfo",JSON.stringify(a)),uni.hideLoading(),uni.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1e3)}catch(u){t("log","at pages/register/register.vue:140",u),uni.hideLoading(),uni.showToast({title:"注册失败，请稍后重试",icon:"none"})}var o},d=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:async e=>{c.value=e.tempFilePaths}})},p=()=>{uni.navigateBack()};return o((()=>{c.value="/static/public/defaultAvatar.png"})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"register-container"},[e.createElementVNode("view",{class:"register-form"},[e.createElementVNode("view",{class:"avatar-container"},[e.createElementVNode("image",{class:"avatar",src:c.value,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"avatar-upload"},[e.createElementVNode("text",{onClick:d},"点击更换头像")])]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"用户名"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),placeholder:"请输入用户名",onInput:a[1]||(a[1]=e=>r.username="")},null,544),[[e.vModelText,l.value]]),r.username?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(r.username),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"确认用户名"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>n.value=e),placeholder:"请再次输入用户名",onInput:a[3]||(a[3]=e=>r.confirmUsername="")},null,544),[[e.vModelText,n.value]]),r.confirmUsername?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(r.confirmUsername),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"密码"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"password","onUpdate:modelValue":a[4]||(a[4]=e=>s.value=e),placeholder:"请输入密码",onInput:a[5]||(a[5]=e=>r.password="")},null,544),[[e.vModelText,s.value]]),r.password?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(r.password),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"input-item"},[e.createElementVNode("text",{class:"input-label"},"确认密码"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"password","onUpdate:modelValue":a[6]||(a[6]=e=>i.value=e),placeholder:"请再次输入密码",onInput:a[7]||(a[7]=e=>r.confirmPassword="")},null,544),[[e.vModelText,i.value]]),r.confirmPassword?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(r.confirmPassword),1)):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"register-options"},[e.createElementVNode("text",{class:"login-link",onClick:p},"已有账号? 去登录")]),e.createElementVNode("button",{class:"register-button",onClick:u},"注册")])]))}}),[["__scopeId","data-v-364a26c9"]]),Z=I(e.defineComponent({__name:"collection",setup(a){const l=e.ref([]);e.ref(!1);let n=e.ref("");const s=()=>{uni.switchTab({url:"/pages/index/index"})};return o((()=>{n=JSON.parse(uni.getStorageSync("userInfo")).userId,v(n).then((e=>{l.value=e}))})),(a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"collection-container"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"content-area"},[l.value.length>0?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"collection-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"collection-item",key:o,onClick:e=>(async e=>{try{const t=await N(e);uni.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(t))}`})}catch(a){t("log","at pages/collection/collection.vue:63",a),uni.showToast({title:"获取详情失败",icon:"none"})}})(a.releaseID)},[e.createElementVNode("image",{class:"item-image",src:c,mode:"aspectFill"}),e.createElementVNode("view",{class:"item-content"},[e.createElementVNode("view",{class:"item-title"},e.toDisplayString(a.title),1),e.createElementVNode("view",{class:"item-desc"},e.toDisplayString(a.content),1),e.createElementVNode("view",{class:"item-meta"},[e.createElementVNode("view",{class:"item-date"},[e.createElementVNode("image",{class:"date-icon",src:P}),e.createTextVNode(" "+e.toDisplayString(a.createdAt.slice(0,10)),1)]),e.createElementVNode("view",{class:"item-actions"},[e.createElementVNode("view",{class:"action-icon",onClick:e.withModifiers((e=>{return o=a.releaseID,void uni.showModal({title:"提示",content:"确定要移除这个收藏吗？",success:async e=>{if(e.confirm)try{await g(n,o);const e=await v(n);l.value=e,uni.showToast({title:"已移除收藏",icon:"success"})}catch(a){t("log","at pages/collection/collection.vue:87",a),uni.showToast({title:"操作失败",icon:"none"})}}});var o}),["stop"])},"取消收藏",8,["onClick"])])])])],8,["onClick"])))),128))]),l.value.length>5?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list-footer"},[e.createElementVNode("text",null,"已经到底啦~")])):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:i,mode:"aspectFit"}),e.createElementVNode("view",{class:"empty-text"},"暂无收藏内容"),e.createElementVNode("view",{class:"empty-subtext"},"收藏喜欢的旅游日记，随时查看"),e.createElementVNode("view",{class:"empty-action",onClick:s},"去发现更多内容")]))])]))}}),[["__scopeId","data-v-82078210"]]),H=I(e.defineComponent({__name:"notes",setup(a){const n=e.ref([]);e.ref(!1);const s=JSON.parse(uni.getStorageSync("userInfo")).userId,c=e.ref(!1),r=e.ref("");let u=e.ref("555"),d=e.ref("555");const v=(e,a)=>{uni.showModal({title:"提示",content:"确定要删除这个笔记吗？",success:async a=>{if(a.confirm)try{await((e,t)=>m(`/api/release/${e}`,{userID:t},"DELETE"))(e.releaseID,s),uni.showToast({title:"已删除",icon:"success"});const t=await p(s);n.value=t}catch(o){t("log","at pages/notes/notes.vue:168",o),uni.showToast({title:"删除失败",icon:"none"})}}})},g=()=>{uni.reLaunch({url:"/pages/Release/Release"})},w=async e=>{try{await(a=e.releaseID,o={state:u.value,reason:d.value},m(`/api/release/${a}/state`,o,"PUT")),uni.showToast({title:"状态已更新",icon:"success"});const t=await p(s);n.value=t}catch(l){t("log","at pages/notes/notes.vue:201",l),uni.showToast({title:"更新状态失败",icon:"none"})}var a,o};return l((async()=>{const e=await p(s);n.value=e})),o((async()=>{const e=await p(s);n.value=e})),(a,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("view",{class:"status-inputs"},[e.createTextVNode(" 状态:"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>e.isRef(u)?u.value=t:u=t),style:{border:"1rpx solid",width:"50%"}},null,512),[[e.vModelText,e.unref(u)]]),e.createTextVNode(" 原因:"),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>e.isRef(d)?d.value=t:d=t),style:{border:"1rpx solid",width:"50%"}},null,512),[[e.vModelText,e.unref(d)]])]),e.createElementVNode("view",{class:"notes-container"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"content-area"},[n.value.length>0?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"notes-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,((a,o)=>{return e.openBlock(),e.createElementBlock("view",{class:"note-item",key:o,onClick:e=>(async(e,a)=>{if("resolve"===a)try{const t=await N(e);uni.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(t))}`})}catch(o){t("log","at pages/notes/notes.vue:137",o),uni.showToast({title:"获取详情失败",icon:"none"})}else uni.showToast({title:"笔记未通过,请继续编辑",icon:"none"})})(a.releaseID,a.state)},[e.createElementVNode("view",{class:"note-header"},[e.createElementVNode("view",{class:"note-title"},e.toDisplayString(a.title),1),e.createElementVNode("view",{class:"note-actions"},[e.createElementVNode("view",{class:"action-icon delete-btn",onClick:e.withModifiers((e=>v(a)),["stop"])},[e.createElementVNode("text",null,"删除")],8,["onClick"]),"resolve"!==a.state?(e.openBlock(),e.createElementBlock("view",{key:0,class:"action-icon edit-btn",onClick:e.withModifiers((e=>{return t=a,void uni.navigateTo({url:`/pages/notes/note-edit?info=${encodeURIComponent(JSON.stringify(t))}`});var t}),["stop"])},[e.createElementVNode("text",null,"编辑")],8,["onClick"])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"action-icon state-btn",style:e.normalizeStyle({backgroundColor:(n=a.state,"wait"===n?"rgba(255, 204, 0, 0.7)":"resolve"===n?"rgba(0, 128, 0, 0.637)":"reject"===n?"rgba(219, 6, 6, 0.516)":"rgba(255, 204, 0, 0.7)")}),onClick:e.withModifiers((e=>w(a)),["stop"])},[e.createElementVNode("text",null,e.toDisplayString((l=a.state,"resolve"===l?"已通过":"reject"===l?"未通过":"待审核")),1),"reject"===a.state?(e.openBlock(),e.createElementBlock("text",{key:0,class:"reason",onClick:e.withModifiers((e=>{return t=a.reason,r.value=t,void(c.value=!0);var t}),["stop"])}," :"+e.toDisplayString(a.reason),9,["onClick"])):e.createCommentVNode("",!0)],12,["onClick"])])]),a.content?(e.openBlock(),e.createElementBlock("view",{key:0,class:"note-content"},e.toDisplayString(a.content),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"note-meta"},[a.location?(e.openBlock(),e.createElementBlock("view",{key:0,class:"note-location"},[e.createElementVNode("image",{class:"location-icon",src:_}),e.createElementVNode("text",null,e.toDisplayString(a.location),1)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"note-date"},e.toDisplayString(a.createdAt.slice(0,10)),1)]),a.pictures&&a.pictures.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"note-images"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.pictures,((t,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:t,mode:"aspectFill",onClick:e.withModifiers((e=>((e,t)=>{const a=e.map((e=>String(e)));uni.previewImage({urls:a,current:e[t]})})(a.pictures,o)),["stop"])},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"view-more"},[e.createElementVNode("text",null,"点击查看详情")])],8,["onClick"]);var l,n})),128))]),e.createElementVNode("view",{class:"list-footer"},[e.createElementVNode("text",null,"已经到底啦~")])],64)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:i,mode:"aspectFit"}),e.createElementVNode("view",{class:"empty-text"},"暂无笔记内容"),e.createElementVNode("view",{class:"empty-subtext"},"分享您的旅游体验"),e.createElementVNode("view",{class:"empty-action",onClick:g},"创建新笔记")]))]),e.createElementVNode("view",{class:"add-button-wrapper",onClick:g},[e.createElementVNode("image",{class:"add-button",src:"/static/public/add.png"}),e.createElementVNode("view",{class:"add-label"},"添加笔记")])]),c.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"reason-popup",onClick:o[4]||(o[4]=e.withModifiers((e=>c.value=!1),["stop"]))},[e.createElementVNode("view",{class:"reason-popup-content",onClick:o[3]||(o[3]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"reason-popup-title"},"未通过原因"),e.createElementVNode("view",{class:"reason-popup-text"},e.toDisplayString(r.value),1),e.createElementVNode("view",{class:"reason-popup-close",onClick:o[2]||(o[2]=e=>c.value=!1)},"关闭")])])):e.createCommentVNode("",!0)],64))}}),[["__scopeId","data-v-dbf4b232"]]),X=I(e.defineComponent({__name:"note-edit",setup(a){const o=e.reactive({id:"",title:"",content:"",location:"",createdAt:"",playTime:"",money:"",personNum:"",pictures:[],videos:[],cover:""}),n=e.reactive({title:"",content:"",location:"",playTime:"",money:"",personNum:"",pictures:""}),s=e.ref([]),c=e.ref([]),r=e.ref(""),u=()=>{let e=!0;(()=>{for(let e in n)n[e]=""})();const t=T(o.title);t.isValid?o.title=t.filteredText:(n.title=t.message,e=!1);const a=b(o.content);if(a.isValid?o.content=a.filteredText:(n.content=a.message,e=!1),o.location){const t=C(o.location);t.isValid?o.location=t.filteredText:(n.location=t.message,e=!1)}return o.playTime&&(isNaN(Number(o.playTime))||Number(o.playTime)<=0)&&(n.playTime="请输入有效的游玩时间",e=!1),o.money&&(isNaN(Number(o.money))||Number(o.money)<0)&&(n.money="请输入有效的费用金额",e=!1),o.personNum&&(isNaN(Number(o.personNum))||Number(o.personNum)<=0||!Number.isInteger(Number(o.personNum)))&&(n.personNum="请输入有效的人数",e=!1),o.pictures&&0!==o.pictures.length||(n.pictures="至少上传一张图片",e=!1),e},d=async()=>{if(u()){uni.showLoading({title:"正在处理..."});try{const t=o.pictures.filter((e=>!s.value.includes(e))),l=o.pictures.filter((e=>s.value.includes(e)));if(t.length>0){const e=await y(t,"image");o.pictures=[...l,...e.pictures]}const n=o.videos.filter((e=>!c.value.includes(e))),i=o.videos.filter((e=>c.value.includes(e)));if(n.length>0){const e=await y(n,"video");o.videos=[...i,...e.videos]}if(o.cover&&o.cover!==r.value){const e=await y(o.cover,"cover");o.cover=e.covers[0]}await(e=o.id,a=o,m(`/api/release/${e}`,a,"PUT")),uni.hideLoading(),uni.showToast({title:"保存成功",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1e3)}catch(l){t("log","at pages/notes/note-edit.vue:244",l),uni.hideLoading(),uni.showToast({title:"保存失败",icon:"error"})}var e,a}},p=()=>{uni.chooseLocation({success:e=>{o.location=e.name||e.address,n.location=""},fail:e=>{t("error","at pages/notes/note-edit.vue:263","选择位置失败",e)}})},v=()=>{uni.chooseImage({count:5-o.pictures.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{uni.showLoading({title:"处理图片中..."});let t=0;const a=e.tempFilePaths.length;e.tempFilePaths.forEach((e=>{uni.compressImage({src:e,quality:80,success:e=>{o.pictures.push(e.tempFilePath),t++,t>=a&&uni.hideLoading()},fail:()=>{o.pictures.push(e),uni.showToast({title:"部分图片压缩失败",icon:"none",duration:1e3}),t++,t>=a&&uni.hideLoading()}})})),n.pictures=""}})},g=()=>{uni.chooseVideo({count:1,compressed:!0,sourceType:["album","camera"],success:e=>{uni.showLoading({title:"处理视频中..."}),uni.getVideoInfo({src:e.tempFilePath,success:t=>{uni.hideLoading(),t.duration>60?uni.showToast({title:"视频时长不能超过1分钟",icon:"none"}):o.videos=[e.tempFilePath]},fail:()=>{uni.hideLoading(),o.videos=[e.tempFilePath]}})}})},w=()=>{o.videos=[]},N=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{uni.showLoading({title:"处理封面中..."}),uni.compressImage({src:e.tempFilePaths[0],quality:80,success:e=>{uni.hideLoading(),o.cover=e.tempFilePath},fail:()=>{uni.hideLoading(),o.cover=e.tempFilePaths[0],uni.showToast({title:"封面压缩失败",icon:"none",duration:1e3})}})}})},k=()=>{o.cover=""};return l((e=>{if(e.info){(e=>{Object.assign(o,{id:e.releaseID,title:e.title,content:e.content,location:e.location,createdAt:e.createdAt,pictures:e.pictures,playTime:e.playTime,money:e.money,personNum:e.personNum,videos:e.videos,cover:e.cover||""}),r.value=e.cover,c.value=e.videos,s.value=e.pictures})(JSON.parse(decodeURIComponent(e.info))),uni.setNavigationBarTitle({title:"编辑笔记"})}})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"note-edit-container"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"edit-area"},[e.withDirectives(e.createElementVNode("input",{class:"note-title-input",placeholder:"请输入标题...","onUpdate:modelValue":a[0]||(a[0]=e=>o.title=e),maxlength:"50",onInput:a[1]||(a[1]=e=>n.title="")},null,544),[[e.vModelText,o.title]]),n.title?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},e.toDisplayString(n.title),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"location-selector",onClick:p},[e.createElementVNode("image",{src:i,mode:"aspectFit"}),o.location?(e.openBlock(),e.createElementBlock("text",{key:0},e.toDisplayString(o.location),1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"placeholder"},"添加位置"))]),n.location?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-text"},e.toDisplayString(n.location),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"detail-info"},[e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("image",{src:F,class:"info-icon"}),e.withDirectives(e.createElementVNode("input",{class:"info-icon-content","onUpdate:modelValue":a[2]||(a[2]=e=>o.money=e),onInput:a[3]||(a[3]=e=>n.money="")},null,544),[[e.vModelText,o.money]]),e.createTextVNode("元 ")]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("image",{src:U,class:"info-icon"}),e.withDirectives(e.createElementVNode("input",{class:"info-icon-content","onUpdate:modelValue":a[4]||(a[4]=e=>o.personNum=e),onInput:a[5]||(a[5]=e=>n.personNum="")},null,544),[[e.vModelText,o.personNum]]),e.createTextVNode("人 ")]),e.createElementVNode("view",{class:"info-item"},[e.createElementVNode("image",{src:P,class:"info-icon"}),e.withDirectives(e.createElementVNode("input",{class:"info-icon-content","onUpdate:modelValue":a[6]||(a[6]=e=>o.playTime=e),onInput:a[7]||(a[7]=e=>n.playTime="")},null,544),[[e.vModelText,o.playTime]]),e.createTextVNode("分钟 ")])]),e.createElementVNode("view",{class:"detail-errors"},[n.money?(e.openBlock(),e.createElementBlock("view",{key:0,class:"error-text"},"费用: "+e.toDisplayString(n.money),1)):e.createCommentVNode("",!0),n.personNum?(e.openBlock(),e.createElementBlock("view",{key:1,class:"error-text"},"人数: "+e.toDisplayString(n.personNum),1)):e.createCommentVNode("",!0),n.playTime?(e.openBlock(),e.createElementBlock("view",{key:2,class:"error-text"},"时间: "+e.toDisplayString(n.playTime),1)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{class:"note-content-input"},[e.withDirectives(e.createElementVNode("textarea",{class:"note-content-input-content",placeholder:"写下你的旅行记录...","onUpdate:modelValue":a[8]||(a[8]=e=>o.content=e),maxlength:"5000","auto-height":"",onInput:a[9]||(a[9]=e=>n.content="")},null,544),[[e.vModelText,o.content]])]),n.content?(e.openBlock(),e.createElementBlock("view",{key:2,class:"error-text"},e.toDisplayString(n.content),1)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"image-section"},[e.createElementVNode("view",{class:"image-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.pictures,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"image-item",key:a},[e.createElementVNode("image",{class:"preview-image",src:t,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"delete-btn",onClick:e=>(e=>{o.pictures.splice(e,1)})(a)},[e.createElementVNode("view",{style:{color:"white"}},"×")],8,["onClick"])])))),128)),o.pictures.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"add-image-btn",onClick:v},[e.createElementVNode("text",null,"+"),e.createElementVNode("text",{class:"add-text"},"添加图片")])):e.createCommentVNode("",!0)])]),n.pictures?(e.openBlock(),e.createElementBlock("view",{key:3,class:"error-text"},e.toDisplayString(n.pictures),1)):e.createCommentVNode("",!0),o.videos&&o.videos.length>0?(e.openBlock(),e.createElementBlock("view",{key:4,class:"video-section"},[e.createElementVNode("view",{class:"video-container"},[e.createElementVNode("video",{class:"preview-video",src:o.videos[0],controls:""},null,8,["src"]),e.createElementVNode("view",{class:"delete-btn",onClick:w},[e.createElementVNode("image",{src:L,mode:"aspectFit"})])]),e.createElementVNode("view",{class:"video-cover-section"},[e.createElementVNode("text",{class:"section-title"},"视频封面"),e.createElementVNode("view",{class:"cover-container"},[o.cover?(e.openBlock(),e.createElementBlock("view",{key:0,class:"cover-preview-wrapper"},[e.createElementVNode("image",{class:"cover-preview",src:o.cover,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"delete-btn",onClick:k},[e.createElementVNode("image",{src:L,mode:"aspectFit"})])])):e.createCommentVNode("",!0),o.cover?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"add-cover-btn",onClick:N},[e.createElementVNode("text",null,"+"),e.createElementVNode("text",{style:{"font-size":"28rpx"}},"添加封面")]))])])])):e.createCommentVNode("",!0),o.videos&&0!==o.videos.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:5,class:"add-video-btn",onClick:g},[e.createElementVNode("text",{class:"add-icon"},"+"),e.createElementVNode("text",{class:"add-text",style:{color:"grey"}},"添加视频")]))]),e.createElementVNode("view",{class:"save-button",onClick:d},"保存笔记")]))}}),[["__scopeId","data-v-e3ecfde6"]]),K=I(e.defineComponent({__name:"list",setup(a){const l=e.ref([]),n=e.ref(""),s=()=>{uni.switchTab({url:"/pages/index/index"})};return o((async()=>{const e=uni.getStorageSync("userInfo");l.value=[],e&&(n.value=JSON.parse(e).userId,await(async()=>{try{const e=await k(n.value);l.value=[];for(const t of e){const e=await d(t),a={userID:e.userID,userName:e.userName,worksCount:JSON.parse(e.release).length,avatar:e.avatar};l.value.push(a)}}catch(e){t("log","at pages/follow/list.vue:93",e)}})())})),(a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"follow-container"},[e.createElementVNode("scroll-view",{"scroll-y":"",class:"content-area"},[l.value.length>0?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"follow-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"follow-item",key:o,onClick:e=>{return t=a.userID,void uni.navigateTo({url:`/pages/follow/works?userID=${t}`});var t}},[e.createElementVNode("image",{class:"user-avatar",src:c,mode:"aspectFill"}),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"user-name"},e.toDisplayString(a.userName),1),e.createElementVNode("view",{class:"works-count"},"作品数: "+e.toDisplayString(a.worksCount||0),1)]),e.createElementVNode("view",{class:"follow-action"},[e.createElementVNode("view",{class:"follow-btn",onClick:e.withModifiers((e=>(async(e,a)=>{uni.showModal({title:"提示",content:"确定要取消关注该用户吗？",success:async o=>{if(o.confirm)try{await f(n.value,e),l.value.splice(a,1),uni.showToast({title:"已取消关注",icon:"success"})}catch(s){t("log","at pages/follow/list.vue:66",s),uni.showToast({title:"操作失败，请稍后重试",icon:"none"})}}})})(a.userID,o)),["stop"])},"取消关注",8,["onClick"])])],8,["onClick"])))),128))]),l.value.length>5?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list-footer"},[e.createElementVNode("text",null,"已经到底啦~")])):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:i,mode:"aspectFit"}),e.createElementVNode("view",{class:"empty-text"},"暂无关注用户"),e.createElementVNode("view",{class:"empty-action",onClick:s},"去发现更多创作者")]))])]))}}),[["__scopeId","data-v-d1b21dd6"]]),Q=I(e.defineComponent({__name:"works",setup(a){const o=e.reactive({});let n=e.ref("");const s=e.ref(!0),r=e.ref([]),m=async()=>{if(n.value=JSON.parse(uni.getStorageSync("userInfo")).userId,s.value)uni.showModal({title:"提示",content:`确定要取消关注"${o.userName}"吗？`,success:async e=>{if(e.confirm)try{await f(n.value,o.userID),s.value=!1,uni.showToast({title:"已取消关注",icon:"success"})}catch(a){t("log","at pages/follow/works.vue:110",a),uni.showToast({title:"操作失败",icon:"none"})}}});else try{await V(n.value,{followUserID:o.userID}),s.value=!0,uni.showToast({title:"关注成功",icon:"success"})}catch(e){t("log","at pages/follow/works.vue:128",e),uni.showToast({title:"关注失败",icon:"none"})}};return l((async e=>{if(e.userID)try{const[t,a]=await Promise.all([p(e.userID),d(e.userID)]);r.value=t,Object.assign(o,a);const l=uni.getStorageSync("userInfo");if(l){const t=await k(JSON.parse(l).userId);s.value=t.includes(e.userID)}}catch(a){t("log","at pages/follow/works.vue:152",a),uni.showToast({title:"获取数据失败",icon:"none"})}})),(a,l)=>(e.openBlock(),e.createElementBlock("view",{class:"works-container"},[e.createElementVNode("view",{class:"user-profile"},[e.createElementVNode("image",{class:"user-avatar",src:c,mode:"aspectFill"}),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("view",{class:"user-name"},e.toDisplayString(o.userName),1),e.createElementVNode("view",{class:"user-stats"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("view",{class:"stat-value"},e.toDisplayString(r.value.length),1),e.createElementVNode("view",{class:"stat-label"},"作品")])])]),e.createElementVNode("view",{class:"follow-action"},[e.createElementVNode("view",{class:"follow-btn",onClick:m},e.toDisplayString(s.value?"已关注":"+ 关注"),1)])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"content-area"},[r.value.length>0?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"works-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,((a,o)=>(e.openBlock(),e.createElementBlock("view",{class:"work-item",key:o,onClick:e=>(async e=>{try{const t=await N(e);uni.navigateTo({url:`/pages/detail/detail?info=${encodeURIComponent(JSON.stringify(t))}`})}catch(a){t("log","at pages/follow/works.vue:85",a),uni.showToast({title:"获取详情失败",icon:"none"})}})(a.releaseID)},[e.createElementVNode("view",{class:"work-header"},[e.createElementVNode("view",{class:"work-title"},e.toDisplayString(a.title),1)]),e.createElementVNode("view",{class:"work-body"},[e.createElementVNode("image",{class:"work-image",src:c,mode:"aspectFill"}),e.createElementVNode("view",{class:"work-content"},[e.createElementVNode("view",{class:"work-desc"},e.toDisplayString(a.content),1)])]),e.createElementVNode("view",{class:"work-meta"},[a.createdAt?(e.openBlock(),e.createElementBlock("view",{key:0,class:"meta-item"},[e.createElementVNode("image",{class:"meta-icon",src:P}),e.createElementVNode("text",null,e.toDisplayString(a.createdAt.slice(0,10)),1)])):e.createCommentVNode("",!0),a.location?(e.openBlock(),e.createElementBlock("view",{key:1,class:"meta-item"},[e.createElementVNode("image",{class:"meta-icon",src:_}),e.createElementVNode("text",null,e.toDisplayString(a.location),1)])):e.createCommentVNode("",!0)])],8,["onClick"])))),128))]),r.value.length>5?(e.openBlock(),e.createElementBlock("view",{key:0,class:"list-footer"},[e.createElementVNode("text",null,"已经到底啦~")])):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{class:"empty-icon",src:i,mode:"aspectFit"}),e.createElementVNode("view",{class:"empty-text"},"暂无作品"),e.createElementVNode("view",{class:"empty-subtext"},"该用户还没有发布任何作品")]))])]))}}),[["__scopeId","data-v-972adcd9"]]);__definePage("pages/index/index",S),__definePage("pages/detail/detail",j),__definePage("pages/My/My",q),__definePage("pages/Release/Release",z),__definePage("pages/login/login",G),__definePage("pages/register/register",W),__definePage("pages/collection/collection",Z),__definePage("pages/notes/notes",H),__definePage("pages/notes/note-edit",X),__definePage("pages/follow/list",K),__definePage("pages/follow/works",Q);const Y={__name:"App",setup:e=>()=>{}};const{app:ee,Vuex:te,Pinia:ae}={app:e.createVueApp(Y)};uni.Vuex=te,uni.Pinia=ae,ee.provide("__globalStyles",__uniConfig.styles),ee._component.mpType="app",ee._component.render=()=>{},ee.mount("#app")}(Vue);
